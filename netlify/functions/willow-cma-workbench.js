/**
 * WILLOW V50 CMA Workbench
 * V3.1: Zillow Zestimate Ã— 102.4% calculation + ATTOM building data
 * 
 * @version 3.1.0
 * @date 2025-11-12
 */

exports.handler = async (event, context) => {
  const headers = {
    'Content-Type': 'text/html; charset=UTF-8',
    'Cache-Control': 'public, max-age=300'
  };

  const htmlContent = `PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+V0lMTE9XIFY1MCBDTUEgV29ya2JlbmNoPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAqIHsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KCiAgICAgICAgYm9keSB7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgT3h5Z2VuLCBVYnVudHUsIENhbnRhcmVsbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgfQoKICAgICAgICAuY29udGFpbmVyIHsKICAgICAgICAgICAgbWF4LXdpZHRoOiAxMjAwcHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgIH0KCiAgICAgICAgLmhlYWRlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBwYWRkaW5nOiAzMHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDEwcHggNDBweCByZ2JhKDAsMCwwLDAuMSk7CiAgICAgICAgfQoKICAgICAgICBoMSB7CiAgICAgICAgICAgIGNvbG9yOiAjMmQzNzQ4OwogICAgICAgICAgICBmb250LXNpemU6IDMycHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgICAgICB9CgogICAgICAgIC5zdWJ0aXRsZSB7CiAgICAgICAgICAgIGNvbG9yOiAjNzE4MDk2OwogICAgICAgICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgICAgfQoKICAgICAgICAuY2FyZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBwYWRkaW5nOiAzMHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDEwcHggNDBweCByZ2JhKDAsMCwwLDAuMSk7CiAgICAgICAgfQoKICAgICAgICAuc2VjdGlvbi10aXRsZSB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMjBweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICAgICAgY29sb3I6ICMyZDM3NDg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogMTBweDsKICAgICAgICB9CgogICAgICAgIC5pbnB1dC1ncm91cCB7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgICAgICAgfQoKICAgICAgICBsYWJlbCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIGNvbG9yOiAjNGE1NTY4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiA4cHg7CiAgICAgICAgfQoKICAgICAgICAubGFiZWwtd2l0aC1iYWRnZSB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogOHB4OwogICAgICAgIH0KCiAgICAgICAgaW5wdXRbdHlwZT0idGV4dCJdLCBpbnB1dFt0eXBlPSJudW1iZXIiXSB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBwYWRkaW5nOiAxMnB4IDE2cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgI2UyZThmMDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zczsKICAgICAgICB9CgogICAgICAgIGlucHV0W3R5cGU9InRleHQiXTpmb2N1cywgaW5wdXRbdHlwZT0ibnVtYmVyIl06Zm9jdXMgewogICAgICAgICAgICBvdXRsaW5lOiBub25lOwogICAgICAgICAgICBib3JkZXItY29sb3I6ICM2NjdlZWE7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMCAwIDNweCByZ2JhKDEwMiwgMTI2LCAyMzQsIDAuMSk7CiAgICAgICAgfQoKICAgICAgICAuc3VnZ2VzdGVkLXZhbHVlLWlucHV0IHsKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgIzQ4YmI3OCAhaW1wb3J0YW50OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjBmZmY0OwogICAgICAgICAgICBmb250LXNpemU6IDIwcHggIWltcG9ydGFudDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICAgICAgY29sb3I6ICMyZDM3NDg7CiAgICAgICAgfQoKICAgICAgICAuYnRuIHsKICAgICAgICAgICAgcGFkZGluZzogMTRweCAyOHB4OwogICAgICAgICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzOwogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgfQoKICAgICAgICAuYnRuLXByaW1hcnkgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjNjY3ZWVhIDAlLCAjNzY0YmEyIDEwMCUpOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQoKICAgICAgICAuYnRuLXByaW1hcnk6aG92ZXIgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMTBweCAyMHB4IHJnYmEoMTAyLCAxMjYsIDIzNCwgMC4zKTsKICAgICAgICB9CgogICAgICAgIC5idG4tc2Vjb25kYXJ5IHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzQ4YmI3ODsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBtYXJnaW4tbGVmdDogMTBweDsKICAgICAgICB9CgogICAgICAgIC5idG4tc2Vjb25kYXJ5OmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzM4YTE2OTsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDEwcHggMjBweCByZ2JhKDcyLCAxODcsIDEyMCwgMC4zKTsKICAgICAgICB9CgogICAgICAgIC5sb2FkaW5nIHsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OwogICAgICAgICAgICBjb2xvcjogIzY2N2VlYTsKICAgICAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgIH0KCiAgICAgICAgLmxvYWRpbmcuYWN0aXZlIHsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgfQoKICAgICAgICAuc3Bpbm5lciB7CiAgICAgICAgICAgIGJvcmRlcjogM3B4IHNvbGlkICNmM2Y0ZjY7CiAgICAgICAgICAgIGJvcmRlci10b3A6IDNweCBzb2xpZCAjNjY3ZWVhOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgICAgIHdpZHRoOiA0MHB4OwogICAgICAgICAgICBoZWlnaHQ6IDQwcHg7CiAgICAgICAgICAgIGFuaW1hdGlvbjogc3BpbiAxcyBsaW5lYXIgaW5maW5pdGU7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvIDEwcHg7CiAgICAgICAgfQoKICAgICAgICBAa2V5ZnJhbWVzIHNwaW4gewogICAgICAgICAgICAwJSB7IHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOyB9CiAgICAgICAgICAgIDEwMCUgeyB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyB9CiAgICAgICAgfQoKICAgICAgICAudmFsdWF0aW9uLXNlY3Rpb24gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjNjY3ZWVhIDAlLCAjNzY0YmEyIDEwMCUpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBwYWRkaW5nOiAzMHB4OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDMwcHg7CiAgICAgICAgfQoKICAgICAgICAudmFsdWF0aW9uLWdyaWQgewogICAgICAgICAgICBkaXNwbGF5OiBncmlkOwogICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDI1MHB4LCAxZnIpKTsKICAgICAgICAgICAgZ2FwOiAyMHB4OwogICAgICAgICAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgICAgIH0KCiAgICAgICAgLnZhbHVhdGlvbi1pdGVtIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cigxMHB4KTsKICAgICAgICB9CgogICAgICAgIC52YWx1YXRpb24tbGFiZWwgewogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgICAgIG9wYWNpdHk6IDAuOTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogOHB4OwogICAgICAgIH0KCiAgICAgICAgLnZhbHVhdGlvbi12YWx1ZSB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMzJweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICB9CgogICAgICAgIC52YWx1YXRpb24tc3VidGV4dCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgb3BhY2l0eTogMC44OwogICAgICAgICAgICBtYXJnaW4tdG9wOiA0cHg7CiAgICAgICAgfQoKICAgICAgICAucHJvcGVydHktZ3JpZCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMjAwcHgsIDFmcikpOwogICAgICAgICAgICBnYXA6IDE1cHg7CiAgICAgICAgfQoKICAgICAgICAucHJvcGVydHktaXRlbSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmN2ZhZmM7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICB9CgogICAgICAgIC5wcm9wZXJ0eS1sYWJlbCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgY29sb3I6ICM3MTgwOTY7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNHB4OwogICAgICAgIH0KCiAgICAgICAgLnByb3BlcnR5LXZhbHVlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAyMHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICBjb2xvcjogIzJkMzc0ODsKICAgICAgICB9CgogICAgICAgIC5lcnJvciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZWQ3ZDc7CiAgICAgICAgICAgIGNvbG9yOiAjYzUzMDMwOwogICAgICAgICAgICBwYWRkaW5nOiAxNXB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDE1cHg7CiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgICAgfQoKICAgICAgICAuZXJyb3IuYWN0aXZlIHsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgfQoKICAgICAgICAud2FybmluZyB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZWY1ZTc7CiAgICAgICAgICAgIGNvbG9yOiAjZDY4OTEwOwogICAgICAgICAgICBwYWRkaW5nOiAxNXB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDE1cHg7CiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgICAgfQoKICAgICAgICAud2FybmluZy5hY3RpdmUgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICB9CgogICAgICAgIC5iYWRnZSB7CiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDEycHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICB9CgogICAgICAgIC5iYWRnZS16aWxsb3cgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMDA3NGU0OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQoKICAgICAgICAuYmFkZ2UtYXR0b20gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjNDhiYjc4OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQoKICAgICAgICAuYmFkZ2Utc3VnZ2VzdGVkIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y2YWQ1NTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgIH0KCiAgICAgICAgLmNtYS1jb250cm9scyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMjAwcHgsIDFmcikpOwogICAgICAgICAgICBnYXA6IDE1cHg7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDIwcHg7CiAgICAgICAgfQoKICAgICAgICAuZm9ybXVsYS1ub3RlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgICAgICBjb2xvcjogIzcxODA5NjsKICAgICAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOwogICAgICAgICAgICBtYXJnaW4tdG9wOiA0cHg7CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgPCEtLSBIZWFkZXIgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0iaGVhZGVyIj4KICAgICAgICAgICAgPGgxPvCfj6EgV0lMTE9XIFY1MCBDTUEgV29ya2JlbmNoPC9oMT4KICAgICAgICAgICAgPHAgY2xhc3M9InN1YnRpdGxlIj5Qb3dlcmVkIGJ5IFppbGxvdyBaZXN0aW1hdGUgKyBBVFRPTSBQcm9wZXJ0eSBJbnRlbGxpZ2VuY2U8L3A+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0gQWRkcmVzcyBJbnB1dCAtLT4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ic3ViamVjdEFkZHJlc3MiPlN1YmplY3QgUHJvcGVydHkgQWRkcmVzczwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgdHlwZT0idGV4dCIgCiAgICAgICAgICAgICAgICAgICAgaWQ9InN1YmplY3RBZGRyZXNzIiAKICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iRW50ZXIgcHJvcGVydHkgYWRkcmVzcy4uLiIKICAgICAgICAgICAgICAgICAgICB2YWx1ZT0iMzAgQXJsbW9udCBzdCBLaW5nc3RvbiBueSAxMjQwMSIKICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tcHJpbWFyeSIgb25jbGljaz0ibG9hZFByb3BlcnR5SW50ZWwoKSI+CiAgICAgICAgICAgICAgICDwn5SNIExvYWQgUHJvcGVydHkgSW50ZWxsaWdlbmNlCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIExvYWRpbmcgU3RhdGUgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGluZyIgaWQ9ImxvYWRpbmdTdGF0ZSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwaW5uZXIiPjwvZGl2PgogICAgICAgICAgICA8ZGl2PkxvYWRpbmcgcHJvcGVydHkgZGF0YS4uLjwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIEVycm9yIFN0YXRlIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImVycm9yIiBpZD0iZXJyb3JTdGF0ZSI+PC9kaXY+CgogICAgICAgIDwhLS0gV2FybmluZyBTdGF0ZSAtLT4KICAgICAgICA8ZGl2IGNsYXNzPSJ3YXJuaW5nIiBpZD0id2FybmluZ1N0YXRlIj48L2Rpdj4KCiAgICAgICAgPCEtLSBWYWx1YXRpb24gU2VjdGlvbiAtLT4KICAgICAgICA8ZGl2IGlkPSJ2YWx1YXRpb25TZWN0aW9uIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2YWx1YXRpb24tc2VjdGlvbiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIiBzdHlsZT0iY29sb3I6IHdoaXRlOyI+CiAgICAgICAgICAgICAgICAgICAg8J+SsCBQcm9wZXJ0eSBWYWx1YXRpb24KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmFsdWF0aW9uLWdyaWQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmFsdWF0aW9uLWxhYmVsIj5aaWxsb3cgWmVzdGltYXRlwq48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmFsdWF0aW9uLXZhbHVlIiBpZD0iemlsbG93VmFsdWUiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi1zdWJ0ZXh0IiBpZD0iemlsbG93RGF0ZSI+TGFzdCB1cGRhdGVkOiAtLTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmFsdWF0aW9uLWxhYmVsIj5aZXN0aW1hdGUgUmFuZ2U8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmFsdWF0aW9uLXZhbHVlIiBzdHlsZT0iZm9udC1zaXplOiAxOHB4OyIgaWQ9InppbGxvd1JhbmdlIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2YWx1YXRpb24tc3VidGV4dCI+VHlwaWNhbCB2YWx1YXRpb24gcmFuZ2U8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPCEtLSBDTUEgQ29uZmlndXJhdGlvbiAtLT4KICAgICAgICA8ZGl2IGlkPSJjbWFTZWN0aW9uIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUiPgogICAgICAgICAgICAgICAgICAgIPCfk4ogQ01BIENvbmZpZ3VyYXRpb24KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8IS0tIFN1Z2dlc3RlZCBDZW50ZXIgVmFsdWUgKFByb21pbmVudCkgLS0+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnB1dC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGFiZWwtd2l0aC1iYWRnZSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InN1Z2dlc3RlZFZhbHVlIj5TdWdnZXN0ZWQgQ01BIENlbnRlciBWYWx1ZTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiYWRnZSBiYWRnZS1zdWdnZXN0ZWQiPlpFU1RJTUFURSDDlyAxMDIuNCU8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0ZXh0IiAKICAgICAgICAgICAgICAgICAgICAgICAgaWQ9InN1Z2dlc3RlZFZhbHVlIiAKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InN1Z2dlc3RlZC12YWx1ZS1pbnB1dCIKICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IkNhbGN1bGF0ZWQgZnJvbSBaZXN0aW1hdGUiCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRvbmx5CiAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm11bGEtbm90ZSI+Rm9ybXVsYTogWmVzdGltYXRlIMOXIDEuMDI0LCByb3VuZGVkIHVwIHRvIG5lYXJlc3QgJDUsMDAwPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8IS0tIE90aGVyIENNQSBQYXJhbWV0ZXJzIC0tPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY21hLWNvbnRyb2xzIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnB1dC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNlbnRlclZhbHVlIj5BY3R1YWwgQ2VudGVyIFZhbHVlIChFZGl0IGlmIG5lZWRlZCk8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0ZXh0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkPSJjZW50ZXJWYWx1ZSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iVXNlIHN1Z2dlc3RlZCBvciBlbnRlciBjdXN0b20iCiAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnB1dC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNtYVJhZGl1cyI+U2VhcmNoIFJhZGl1cyAobWlsZXMpPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImNtYVJhZGl1cyIgdmFsdWU9IjAuNSIgc3RlcD0iMC4xIiBtaW49IjAuMSIgbWF4PSI1Ij4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnB1dC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNtYURheXNCYWNrIj5EYXlzIEJhY2s8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iY21hRGF5c0JhY2siIHZhbHVlPSIxODAiIHN0ZXA9IjMwIiBtaW49IjMwIiBtYXg9IjczMCI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjbWFDb21wcyI+TnVtYmVyIG9mIENvbXBzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImNtYUNvbXBzIiB2YWx1ZT0iNiIgbWluPSIzIiBtYXg9IjEyIj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zZWNvbmRhcnkiIG9uY2xpY2s9ImdlbmVyYXRlQ01BKCkiIHN0eWxlPSJtYXJnaW4tdG9wOiAyMHB4OyBtYXJnaW4tbGVmdDogMDsiPgogICAgICAgICAgICAgICAgICAgIPCfjq8gR2VuZXJhdGUgQ01BIFJlcG9ydAogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIFByb3BlcnR5IENoYXJhY3RlcmlzdGljcyAtLT4KICAgICAgICA8ZGl2IGlkPSJwcm9wZXJ0eVNlY3Rpb24iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSI+CiAgICAgICAgICAgICAgICAgICAg8J+PoCBQcm9wZXJ0eSBDaGFyYWN0ZXJpc3RpY3MKICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYmFkZ2UgYmFkZ2UtYXR0b20iPkFUVE9NIERBVEE8L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWdyaWQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1sYWJlbCI+QmVkcm9vbXM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wQmVkcyI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPkJhdGhyb29tczwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS12YWx1ZSIgaWQ9InByb3BCYXRocyI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPlNxdWFyZSBGZWV0PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcFNxZnQiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5Mb3QgU2l6ZTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS12YWx1ZSIgaWQ9InByb3BBY3JlcyI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPlllYXIgQnVpbHQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wWWVhciI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPlByb3BlcnR5IFR5cGU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wVHlwZSI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPkNvbmRpdGlvbjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS12YWx1ZSIgaWQ9InByb3BDb25kaXRpb24iPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5HYXJhZ2UgU3BhY2VzPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcEdhcmFnZSI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPkhlYXRpbmc8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wSGVhdGluZyI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPkNvb2xpbmc8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wQ29vbGluZyI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPlN0b3JpZXM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wU3RvcmllcyI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPkFUVE9NIElEPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcEF0dG9tSWQiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8c2NyaXB0PgogICAgICAgIGxldCBjdXJyZW50UHJvcGVydHlEYXRhID0gbnVsbDsKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gbG9hZFByb3BlcnR5SW50ZWwoKSB7CiAgICAgICAgICAgIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3ViamVjdEFkZHJlc3MnKS52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIWFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIHNob3dFcnJvcignUGxlYXNlIGVudGVyIGEgcHJvcGVydHkgYWRkcmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTaG93IGxvYWRpbmcgc3RhdGUKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdTdGF0ZScpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTdGF0ZScpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2FybmluZ1N0YXRlJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2YWx1YXRpb25TZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtYVNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvcGVydHlTZWN0aW9uJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBGZXRjaCBib3RoIFppbGxvdyBhbmQgQVRUT00gZGF0YSBpbiBwYXJhbGxlbAogICAgICAgICAgICAgICAgY29uc3QgW3ppbGxvd1Jlc3VsdCwgYXR0b21EYXRhXSA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChbCiAgICAgICAgICAgICAgICAgICAgZmV0Y2haaWxsb3dEYXRhKGFkZHJlc3MpLAogICAgICAgICAgICAgICAgICAgIGZldGNoQXR0b21EYXRhKGFkZHJlc3MpCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAvLyBDaGVjayBBVFRPTSBkYXRhIChjcml0aWNhbCkKICAgICAgICAgICAgICAgIGlmIChhdHRvbURhdGEuc3RhdHVzID09PSAncmVqZWN0ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggQVRUT00gcHJvcGVydHkgZGF0YScpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGN1cnJlbnRQcm9wZXJ0eURhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogYWRkcmVzcywKICAgICAgICAgICAgICAgICAgICB6aWxsb3c6IHppbGxvd1Jlc3VsdC5zdGF0dXMgPT09ICdmdWxmaWxsZWQnID8gemlsbG93UmVzdWx0LnZhbHVlIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBhdHRvbTogYXR0b21EYXRhLnZhbHVlCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIERpc3BsYXkgdGhlIGRhdGEKICAgICAgICAgICAgICAgIGlmICh6aWxsb3dSZXN1bHQuc3RhdHVzID09PSAnZnVsZmlsbGVkJykgewogICAgICAgICAgICAgICAgICAgIGRpc3BsYXlaaWxsb3dEYXRhKHppbGxvd1Jlc3VsdC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZhbHVhdGlvblNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd1dhcm5pbmcoJ1ppbGxvdyBkYXRhIHVuYXZhaWxhYmxlLiBQbGVhc2UgZW50ZXIgWmVzdGltYXRlIG1hbnVhbGx5IG9yIHVzZSBzdWdnZXN0ZWQgdmFsdWUgYmFzZWQgb24gQVRUT00gZGF0YS4nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkaXNwbGF5QXR0b21EYXRhKGF0dG9tRGF0YS52YWx1ZSk7CgogICAgICAgICAgICAgICAgLy8gU2hvdyBzZWN0aW9ucwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtYVNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wZXJ0eVNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBzaG93RXJyb3IoJ0ZhaWxlZCB0byBsb2FkIHByb3BlcnR5IGRhdGE6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nU3RhdGUnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2haaWxsb3dEYXRhKGFkZHJlc3MpIHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgLy5uZXRsaWZ5L2Z1bmN0aW9ucy96aWxsb3ctemVzdGltYXRlP2FkZHJlc3M9JHtlbmNvZGVVUklDb21wb25lbnQoYWRkcmVzcyl9YCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JEYXRhLm1lc3NhZ2UgfHwgJ1ppbGxvdyBsb29rdXAgZmFpbGVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBmZXRjaEF0dG9tRGF0YShhZGRyZXNzKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYC8ubmV0bGlmeS9mdW5jdGlvbnMvYXR0b20tYnVpbGRpbmctZGF0YT9hZGRyZXNzPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGFkZHJlc3MpfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yRGF0YS5tZXNzYWdlIHx8ICdBVFRPTSBsb29rdXAgZmFpbGVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkaXNwbGF5WmlsbG93RGF0YShkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS56ZXN0aW1hdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgeiA9IGRhdGEuemVzdGltYXRlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGlzcGxheSBaZXN0aW1hdGUgdmFsdWUKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ppbGxvd1ZhbHVlJykudGV4dENvbnRlbnQgPSBmb3JtYXRDdXJyZW5jeSh6LnZhbHVlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERpc3BsYXkgbGFzdCB1cGRhdGVkIGRhdGUKICAgICAgICAgICAgaWYgKHoubGFzdFVwZGF0ZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh6Lmxhc3RVcGRhdGVkKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6aWxsb3dEYXRlJykudGV4dENvbnRlbnQgPSAnTGFzdCB1cGRhdGVkOiAnICsgZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRGlzcGxheSB2YWx1YXRpb24gcmFuZ2UKICAgICAgICAgICAgaWYgKHoudmFsdWF0aW9uUmFuZ2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gYCR7Zm9ybWF0Q3VycmVuY3koei52YWx1YXRpb25SYW5nZS5sb3cpfSAtICR7Zm9ybWF0Q3VycmVuY3koei52YWx1YXRpb25SYW5nZS5oaWdoKX1gOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ppbGxvd1JhbmdlJykudGV4dENvbnRlbnQgPSByYW5nZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHN1Z2dlc3RlZCBDTUEgdmFsdWU6IFplc3RpbWF0ZSDDlyAxLjAyNCwgcm91bmQgVVAgdG8gbmVhcmVzdCAkNSwwMDAKICAgICAgICAgICAgY29uc3Qgc3VnZ2VzdGVkVmFsdWUgPSBjYWxjdWxhdGVTdWdnZXN0ZWRWYWx1ZSh6LnZhbHVlKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1Z2dlc3RlZFZhbHVlJykudmFsdWUgPSBmb3JtYXRDdXJyZW5jeShzdWdnZXN0ZWRWYWx1ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBQcmUtcG9wdWxhdGUgYWN0dWFsIGNlbnRlciB2YWx1ZSB3aXRoIHN1Z2dlc3RlZCB2YWx1ZQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2VudGVyVmFsdWUnKS52YWx1ZSA9IGZvcm1hdEN1cnJlbmN5KHN1Z2dlc3RlZFZhbHVlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVN1Z2dlc3RlZFZhbHVlKHplc3RpbWF0ZSkgewogICAgICAgICAgICAvLyBTdGVwIDE6IE11bHRpcGx5IGJ5IDEuMDI0ICgxMDIuNCUpCiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZWQgPSB6ZXN0aW1hdGUgKiAxLjAyNDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0ZXAgMjogUm91bmQgVVAgdG8gbmVhcmVzdCAkNSwwMDAKICAgICAgICAgICAgY29uc3Qgcm91bmRlZFVwID0gTWF0aC5jZWlsKG11bHRpcGxpZWQgLyA1MDAwKSAqIDUwMDA7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcm91bmRlZFVwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGlzcGxheUF0dG9tRGF0YShkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS5wcm9wZXJ0eSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBwID0gZGF0YS5wcm9wZXJ0eTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wQmVkcycpLnRleHRDb250ZW50ID0gcC5iZWRzIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wQmF0aHMnKS50ZXh0Q29udGVudCA9IHAuYmF0aHMgfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BTcWZ0JykudGV4dENvbnRlbnQgPSBwLnNxZnQgPyBwLnNxZnQudG9Mb2NhbGVTdHJpbmcoKSArICcgc3EgZnQnIDogJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BBY3JlcycpLnRleHRDb250ZW50ID0gcC5hY3JlcyA/IHAuYWNyZXMgKyAnIGFjcmVzJyA6ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wWWVhcicpLnRleHRDb250ZW50ID0gcC55ZWFyQnVpbHQgfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BUeXBlJykudGV4dENvbnRlbnQgPSBwLnByb3BlcnR5VHlwZSB8fCAnLS0nOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvcENvbmRpdGlvbicpLnRleHRDb250ZW50ID0gcC5jb25kaXRpb24gfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BHYXJhZ2UnKS50ZXh0Q29udGVudCA9IHAuZ2FyYWdlIHx8ICctLSc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZGRpdGlvbmFsIGRldGFpbHMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BIZWF0aW5nJykudGV4dENvbnRlbnQgPSBwLmhlYXRpbmcgfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BDb29saW5nJykudGV4dENvbnRlbnQgPSBwLmNvb2xpbmcgfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BTdG9yaWVzJykudGV4dENvbnRlbnQgPSBwLnN0b3JpZXMgfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BBdHRvbUlkJykudGV4dENvbnRlbnQgPSBwLmF0dG9tSWQgfHwgJy0tJzsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZvcm1hdEN1cnJlbmN5KHZhbHVlKSB7CiAgICAgICAgICAgIGlmICghdmFsdWUgJiYgdmFsdWUgIT09IDApIHJldHVybiAnLS0nOwogICAgICAgICAgICByZXR1cm4gJyQnICsgTWF0aC5yb3VuZCh2YWx1ZSkudG9Mb2NhbGVTdHJpbmcoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlKSB7CiAgICAgICAgICAgIGNvbnN0IGVycm9yRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JTdGF0ZScpOwogICAgICAgICAgICBlcnJvckVsLnRleHRDb250ZW50ID0gJ+KdjCAnICsgbWVzc2FnZTsKICAgICAgICAgICAgZXJyb3JFbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNob3dXYXJuaW5nKG1lc3NhZ2UpIHsKICAgICAgICAgICAgY29uc3Qgd2FybmluZ0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhcm5pbmdTdGF0ZScpOwogICAgICAgICAgICB3YXJuaW5nRWwudGV4dENvbnRlbnQgPSAn4pqg77iPICcgKyBtZXNzYWdlOwogICAgICAgICAgICB3YXJuaW5nRWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZUNNQSgpIHsKICAgICAgICAgICAgaWYgKCFjdXJyZW50UHJvcGVydHlEYXRhKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnUGxlYXNlIGxvYWQgcHJvcGVydHkgZGF0YSBmaXJzdCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjZW50ZXJWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZW50ZXJWYWx1ZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBzdWdnZXN0ZWRWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWdnZXN0ZWRWYWx1ZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCByYWRpdXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21hUmFkaXVzJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGRheXNCYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtYURheXNCYWNrJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGNvbXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtYUNvbXBzJykudmFsdWU7CgogICAgICAgICAgICBhbGVydChg8J+OryBDTUEgR2VuZXJhdGlvbiBSZWFkeVxuXG5Qcm9wZXJ0eTogJHtjdXJyZW50UHJvcGVydHlEYXRhLmFkZHJlc3N9XG5TdWdnZXN0ZWQgVmFsdWU6ICR7c3VnZ2VzdGVkVmFsdWV9XG5Vc2luZyBDZW50ZXIgVmFsdWU6ICR7Y2VudGVyVmFsdWV9XG5SYWRpdXM6ICR7cmFkaXVzfSBtaWxlc1xuRGF5cyBCYWNrOiAke2RheXNCYWNrfVxuQ29tcGFyYWJsZXM6ICR7Y29tcHN9XG5cbkludGVncmF0aW5nIHdpdGggQ2xvdWRDTUEuLi5gKTsKICAgICAgICB9CgogICAgICAgIC8vIEF1dG8tbG9hZCBvbiBwYWdlIGxvYWQgKGZvciB0ZXN0aW5nIHdpdGggcHJlcG9wdWxhdGVkIGFkZHJlc3MpCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy8gVW5jb21tZW50IHRvIGF1dG8tbG9hZCBvbiBwYWdlIGxvYWQKICAgICAgICAgICAgLy8gbG9hZFByb3BlcnR5SW50ZWwoKTsKICAgICAgICB9KTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K`;

  return {
    statusCode: 200,
    headers,
    body: Buffer.from(htmlContent, 'base64').toString('utf-8')
  };
};
