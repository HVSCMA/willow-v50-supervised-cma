/**
 * WILLOW V50 CMA Workbench
 * Simplified version with Zillow Zestimate + ATTOM Building Data
 * 
 * @version 3.0.0
 * @date 2025-11-12
 */

exports.handler = async (event, context) => {
  const headers = {
    'Content-Type': 'text/html; charset=UTF-8',
    'Cache-Control': 'public, max-age=300'
  };

  const htmlContent = `PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+V0lMTE9XIFY1MCBDTUEgV29ya2JlbmNoPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAqIHsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KCiAgICAgICAgYm9keSB7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgT3h5Z2VuLCBVYnVudHUsIENhbnRhcmVsbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgfQoKICAgICAgICAuY29udGFpbmVyIHsKICAgICAgICAgICAgbWF4LXdpZHRoOiAxMjAwcHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgIH0KCiAgICAgICAgLmhlYWRlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBwYWRkaW5nOiAzMHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDEwcHggNDBweCByZ2JhKDAsMCwwLDAuMSk7CiAgICAgICAgfQoKICAgICAgICBoMSB7CiAgICAgICAgICAgIGNvbG9yOiAjMmQzNzQ4OwogICAgICAgICAgICBmb250LXNpemU6IDMycHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgICAgICB9CgogICAgICAgIC5zdWJ0aXRsZSB7CiAgICAgICAgICAgIGNvbG9yOiAjNzE4MDk2OwogICAgICAgICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgICAgfQoKICAgICAgICAuY2FyZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICAgICAgICBwYWRkaW5nOiAzMHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDEwcHggNDBweCByZ2JhKDAsMCwwLDAuMSk7CiAgICAgICAgfQoKICAgICAgICAuc2VjdGlvbi10aXRsZSB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMjBweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICAgICAgY29sb3I6ICMyZDM3NDg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogMTBweDsKICAgICAgICB9CgogICAgICAgIC5pbnB1dC1ncm91cCB7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgICAgICAgfQoKICAgICAgICBsYWJlbCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgIGNvbG9yOiAjNGE1NTY4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiA4cHg7CiAgICAgICAgfQoKICAgICAgICBpbnB1dFt0eXBlPSJ0ZXh0Il0sIGlucHV0W3R5cGU9Im51bWJlciJdIHsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIHBhZGRpbmc6IDEycHggMTZweDsKICAgICAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjZTJlOGYwOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzOwogICAgICAgIH0KCiAgICAgICAgaW5wdXRbdHlwZT0idGV4dCJdOmZvY3VzLCBpbnB1dFt0eXBlPSJudW1iZXIiXTpmb2N1cyB7CiAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzY2N2VlYTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYmEoMTAyLCAxMjYsIDIzNCwgMC4xKTsKICAgICAgICB9CgogICAgICAgIC5idG4gewogICAgICAgICAgICBwYWRkaW5nOiAxNHB4IDI4cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuM3M7CiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgICB9CgogICAgICAgIC5idG4tcHJpbWFyeSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSk7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CgogICAgICAgIC5idG4tcHJpbWFyeTpob3ZlciB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMnB4KTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAxMHB4IDIwcHggcmdiYSgxMDIsIDEyNiwgMjM0LCAwLjMpOwogICAgICAgIH0KCiAgICAgICAgLmJ0bi1zZWNvbmRhcnkgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjNDhiYjc4OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAxMHB4OwogICAgICAgIH0KCiAgICAgICAgLmJ0bi1zZWNvbmRhcnk6aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMzhhMTY5OwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMTBweCAyMHB4IHJnYmEoNzIsIDE4NywgMTIwLCAwLjMpOwogICAgICAgIH0KCiAgICAgICAgLmxvYWRpbmcgewogICAgICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgICAgIGNvbG9yOiAjNjY3ZWVhOwogICAgICAgICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgICAgfQoKICAgICAgICAubG9hZGluZy5hY3RpdmUgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICB9CgogICAgICAgIC5zcGlubmVyIHsKICAgICAgICAgICAgYm9yZGVyOiAzcHggc29saWQgI2YzZjRmNjsKICAgICAgICAgICAgYm9yZGVyLXRvcDogM3B4IHNvbGlkICM2NjdlZWE7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgd2lkdGg6IDQwcHg7CiAgICAgICAgICAgIGhlaWdodDogNDBweDsKICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDFzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgbWFyZ2luOiAwIGF1dG8gMTBweDsKICAgICAgICB9CgogICAgICAgIEBrZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7IH0KICAgICAgICAgICAgMTAwJSB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0KICAgICAgICB9CgogICAgICAgIC52YWx1YXRpb24tc2VjdGlvbiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSk7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDMwcHg7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMzBweDsKICAgICAgICB9CgogICAgICAgIC52YWx1YXRpb24tZ3JpZCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMjUwcHgsIDFmcikpOwogICAgICAgICAgICBnYXA6IDIwcHg7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDIwcHg7CiAgICAgICAgfQoKICAgICAgICAudmFsdWF0aW9uLWl0ZW0gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgcGFkZGluZzogMjBweDsKICAgICAgICAgICAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDEwcHgpOwogICAgICAgIH0KCiAgICAgICAgLnZhbHVhdGlvbi1sYWJlbCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgb3BhY2l0eTogMC45OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiA4cHg7CiAgICAgICAgfQoKICAgICAgICAudmFsdWF0aW9uLXZhbHVlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAzMnB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgIH0KCiAgICAgICAgLnZhbHVhdGlvbi1zdWJ0ZXh0IHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgICAgICBvcGFjaXR5OiAwLjg7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDRweDsKICAgICAgICB9CgogICAgICAgIC5wcm9wZXJ0eS1ncmlkIHsKICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoYXV0by1maXQsIG1pbm1heCgyMDBweCwgMWZyKSk7CiAgICAgICAgICAgIGdhcDogMTVweDsKICAgICAgICB9CgogICAgICAgIC5wcm9wZXJ0eS1pdGVtIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y3ZmFmYzsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICBwYWRkaW5nOiAxNXB4OwogICAgICAgIH0KCiAgICAgICAgLnByb3BlcnR5LWxhYmVsIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjb2xvcjogIzcxODA5NjsKICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuNXB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiA0cHg7CiAgICAgICAgfQoKICAgICAgICAucHJvcGVydHktdmFsdWUgewogICAgICAgICAgICBmb250LXNpemU6IDIwcHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIGNvbG9yOiAjMmQzNzQ4OwogICAgICAgIH0KCiAgICAgICAgLmVycm9yIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZlZDdkNzsKICAgICAgICAgICAgY29sb3I6ICNjNTMwMzA7CiAgICAgICAgICAgIHBhZGRpbmc6IDE1cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMTVweDsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICB9CgogICAgICAgIC5lcnJvci5hY3RpdmUgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICB9CgogICAgICAgIC5iYWRnZSB7CiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDEycHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDEwcHg7CiAgICAgICAgfQoKICAgICAgICAuYmFkZ2UtemlsbG93IHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzAwNzRlNDsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgIH0KCiAgICAgICAgLmJhZGdlLWF0dG9tIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzQ4YmI3ODsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgIH0KCiAgICAgICAgLmNtYS1jb250cm9scyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMjAwcHgsIDFmcikpOwogICAgICAgICAgICBnYXA6IDE1cHg7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDIwcHg7CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgPCEtLSBIZWFkZXIgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0iaGVhZGVyIj4KICAgICAgICAgICAgPGgxPvCfj6EgV0lMTE9XIFY1MCBDTUEgV29ya2JlbmNoPC9oMT4KICAgICAgICAgICAgPHAgY2xhc3M9InN1YnRpdGxlIj5Qb3dlcmVkIGJ5IFppbGxvdyBaZXN0aW1hdGUgKyBBVFRPTSBQcm9wZXJ0eSBJbnRlbGxpZ2VuY2U8L3A+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0gQWRkcmVzcyBJbnB1dCAtLT4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ic3ViamVjdEFkZHJlc3MiPlN1YmplY3QgUHJvcGVydHkgQWRkcmVzczwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgdHlwZT0idGV4dCIgCiAgICAgICAgICAgICAgICAgICAgaWQ9InN1YmplY3RBZGRyZXNzIiAKICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iRW50ZXIgcHJvcGVydHkgYWRkcmVzcy4uLiIKICAgICAgICAgICAgICAgICAgICB2YWx1ZT0iMzAgQXJsbW9udCBzdCBLaW5nc3RvbiBueSAxMjQwMSIKICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tcHJpbWFyeSIgb25jbGljaz0ibG9hZFByb3BlcnR5SW50ZWwoKSI+CiAgICAgICAgICAgICAgICDwn5SNIExvYWQgUHJvcGVydHkgSW50ZWxsaWdlbmNlCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIExvYWRpbmcgU3RhdGUgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGluZyIgaWQ9ImxvYWRpbmdTdGF0ZSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwaW5uZXIiPjwvZGl2PgogICAgICAgICAgICA8ZGl2PkxvYWRpbmcgcHJvcGVydHkgZGF0YS4uLjwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIEVycm9yIFN0YXRlIC0tPgogICAgICAgIDxkaXYgY2xhc3M9ImVycm9yIiBpZD0iZXJyb3JTdGF0ZSI+PC9kaXY+CgogICAgICAgIDwhLS0gVmFsdWF0aW9uIFNlY3Rpb24gLS0+CiAgICAgICAgPGRpdiBpZD0idmFsdWF0aW9uU2VjdGlvbiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idmFsdWF0aW9uLXNlY3Rpb24iPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSIgc3R5bGU9ImNvbG9yOiB3aGl0ZTsiPgogICAgICAgICAgICAgICAgICAgIPCfkrAgUHJvcGVydHkgVmFsdWF0aW9uCiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi1ncmlkIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2YWx1YXRpb24taXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi1sYWJlbCI+WmlsbG93IFplc3RpbWF0ZcKuPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi12YWx1ZSIgaWQ9InppbGxvd1ZhbHVlIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2YWx1YXRpb24tc3VidGV4dCIgaWQ9InppbGxvd0RhdGUiPkxhc3QgdXBkYXRlZDogLS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2YWx1YXRpb24taXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi1sYWJlbCI+WmVzdGltYXRlIFJhbmdlPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVhdGlvbi12YWx1ZSIgc3R5bGU9ImZvbnQtc2l6ZTogMThweDsiIGlkPSJ6aWxsb3dSYW5nZSI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmFsdWF0aW9uLXN1YnRleHQiPlR5cGljYWwgdmFsdWF0aW9uIHJhbmdlPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDwhLS0gQ01BIENvbmZpZ3VyYXRpb24gLS0+CiAgICAgICAgPGRpdiBpZD0iY21hU2VjdGlvbiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIj4KICAgICAgICAgICAgICAgICAgICDwn5OKIENNQSBDb25maWd1cmF0aW9uCiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNtYS1jb250cm9scyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjZW50ZXJWYWx1ZSI+Q2VudGVyIFZhbHVlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0idGV4dCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD0iY2VudGVyVmFsdWUiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IkF1dG8tcG9wdWxhdGVkIGZyb20gWmVzdGltYXRlIgogICAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjbWFSYWRpdXMiPlNlYXJjaCBSYWRpdXMgKG1pbGVzKTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJjbWFSYWRpdXMiIHZhbHVlPSIwLjUiIHN0ZXA9IjAuMSIgbWluPSIwLjEiIG1heD0iNSI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjbWFEYXlzQmFjayI+RGF5cyBCYWNrPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImNtYURheXNCYWNrIiB2YWx1ZT0iMTgwIiBzdGVwPSIzMCIgbWluPSIzMCIgbWF4PSI3MzAiPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iY21hQ29tcHMiPk51bWJlciBvZiBDb21wczwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJjbWFDb21wcyIgdmFsdWU9IjYiIG1pbj0iMyIgbWF4PSIxMiI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc2Vjb25kYXJ5IiBvbmNsaWNrPSJnZW5lcmF0ZUNNQSgpIiBzdHlsZT0ibWFyZ2luLXRvcDogMjBweDsgbWFyZ2luLWxlZnQ6IDA7Ij4KICAgICAgICAgICAgICAgICAgICDwn46vIEdlbmVyYXRlIENNQSBSZXBvcnQKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPCEtLSBQcm9wZXJ0eSBDaGFyYWN0ZXJpc3RpY3MgLS0+CiAgICAgICAgPGRpdiBpZD0icHJvcGVydHlTZWN0aW9uIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUiPgogICAgICAgICAgICAgICAgICAgIPCfj6AgUHJvcGVydHkgQ2hhcmFjdGVyaXN0aWNzCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImJhZGdlIGJhZGdlLWF0dG9tIj5BVFRPTSBEQVRBPC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1ncmlkIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktbGFiZWwiPkJlZHJvb21zPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcEJlZHMiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5CYXRocm9vbXM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wQmF0aHMiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5TcXVhcmUgRmVldDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS12YWx1ZSIgaWQ9InByb3BTcWZ0Ij4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1sYWJlbCI+TG90IFNpemU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wQWNyZXMiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5ZZWFyIEJ1aWx0PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcFllYXIiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5Qcm9wZXJ0eSBUeXBlPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcFR5cGUiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5Db25kaXRpb248L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktdmFsdWUiIGlkPSJwcm9wQ29uZGl0aW9uIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS1sYWJlbCI+R2FyYWdlIFNwYWNlczwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS12YWx1ZSIgaWQ9InByb3BHYXJhZ2UiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5IZWF0aW5nPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcEhlYXRpbmciPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5Db29saW5nPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcENvb2xpbmciPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5TdG9yaWVzPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LXZhbHVlIiBpZD0icHJvcFN0b3JpZXMiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWxhYmVsIj5BVFRPTSBJRDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9wZXJ0eS12YWx1ZSIgaWQ9InByb3BBdHRvbUlkIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPHNjcmlwdD4KICAgICAgICBsZXQgY3VycmVudFByb3BlcnR5RGF0YSA9IG51bGw7CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWRQcm9wZXJ0eUludGVsKCkgewogICAgICAgICAgICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1YmplY3RBZGRyZXNzJykudmFsdWUudHJpbSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFhZGRyZXNzKSB7CiAgICAgICAgICAgICAgICBzaG93RXJyb3IoJ1BsZWFzZSBlbnRlciBhIHByb3BlcnR5IGFkZHJlc3MnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2hvdyBsb2FkaW5nIHN0YXRlCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nU3RhdGUnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU3RhdGUnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZhbHVhdGlvblNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21hU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wZXJ0eVNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIEZldGNoIGJvdGggWmlsbG93IGFuZCBBVFRPTSBkYXRhIGluIHBhcmFsbGVsCiAgICAgICAgICAgICAgICBjb25zdCBbemlsbG93RGF0YSwgYXR0b21EYXRhXSA9IGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICAgICAgICAgICAgICBmZXRjaFppbGxvd0RhdGEoYWRkcmVzcyksCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hBdHRvbURhdGEoYWRkcmVzcykKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGN1cnJlbnRQcm9wZXJ0eURhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogYWRkcmVzcywKICAgICAgICAgICAgICAgICAgICB6aWxsb3c6IHppbGxvd0RhdGEsCiAgICAgICAgICAgICAgICAgICAgYXR0b206IGF0dG9tRGF0YQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvLyBEaXNwbGF5IHRoZSBkYXRhCiAgICAgICAgICAgICAgICBkaXNwbGF5WmlsbG93RGF0YSh6aWxsb3dEYXRhKTsKICAgICAgICAgICAgICAgIGRpc3BsYXlBdHRvbURhdGEoYXR0b21EYXRhKTsKCiAgICAgICAgICAgICAgICAvLyBTaG93IHNlY3Rpb25zCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmFsdWF0aW9uU2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtYVNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wZXJ0eVNlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBzaG93RXJyb3IoJ0ZhaWxlZCB0byBsb2FkIHByb3BlcnR5IGRhdGE6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nU3RhdGUnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2haaWxsb3dEYXRhKGFkZHJlc3MpIHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgLy5uZXRsaWZ5L2Z1bmN0aW9ucy96aWxsb3ctemVzdGltYXRlP2FkZHJlc3M9JHtlbmNvZGVVUklDb21wb25lbnQoYWRkcmVzcyl9YCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JEYXRhLm1lc3NhZ2UgfHwgJ1ppbGxvdyBsb29rdXAgZmFpbGVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBmZXRjaEF0dG9tRGF0YShhZGRyZXNzKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYC8ubmV0bGlmeS9mdW5jdGlvbnMvYXR0b20tYnVpbGRpbmctZGF0YT9hZGRyZXNzPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGFkZHJlc3MpfWApOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yRGF0YS5tZXNzYWdlIHx8ICdBVFRPTSBsb29rdXAgZmFpbGVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkaXNwbGF5WmlsbG93RGF0YShkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS56ZXN0aW1hdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgeiA9IGRhdGEuemVzdGltYXRlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGlzcGxheSBaZXN0aW1hdGUgdmFsdWUKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ppbGxvd1ZhbHVlJykudGV4dENvbnRlbnQgPSBmb3JtYXRDdXJyZW5jeSh6LnZhbHVlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERpc3BsYXkgbGFzdCB1cGRhdGVkIGRhdGUKICAgICAgICAgICAgaWYgKHoubGFzdFVwZGF0ZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh6Lmxhc3RVcGRhdGVkKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6aWxsb3dEYXRlJykudGV4dENvbnRlbnQgPSAnTGFzdCB1cGRhdGVkOiAnICsgZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRGlzcGxheSB2YWx1YXRpb24gcmFuZ2UKICAgICAgICAgICAgaWYgKHoudmFsdWF0aW9uUmFuZ2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gYCR7Zm9ybWF0Q3VycmVuY3koei52YWx1YXRpb25SYW5nZS5sb3cpfSAtICR7Zm9ybWF0Q3VycmVuY3koei52YWx1YXRpb25SYW5nZS5oaWdoKX1gOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ppbGxvd1JhbmdlJykudGV4dENvbnRlbnQgPSByYW5nZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUHJlLXBvcHVsYXRlIENNQSBjZW50ZXIgdmFsdWUgd2l0aCBaZXN0aW1hdGUKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NlbnRlclZhbHVlJykudmFsdWUgPSBmb3JtYXRDdXJyZW5jeSh6LnZhbHVlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlBdHRvbURhdGEoZGF0YSkgewogICAgICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEucHJvcGVydHkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgcCA9IGRhdGEucHJvcGVydHk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvcEJlZHMnKS50ZXh0Q29udGVudCA9IHAuYmVkcyB8fCAnLS0nOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvcEJhdGhzJykudGV4dENvbnRlbnQgPSBwLmJhdGhzIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wU3FmdCcpLnRleHRDb250ZW50ID0gcC5zcWZ0ID8gcC5zcWZ0LnRvTG9jYWxlU3RyaW5nKCkgKyAnIHNxIGZ0JyA6ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wQWNyZXMnKS50ZXh0Q29udGVudCA9IHAuYWNyZXMgPyBwLmFjcmVzICsgJyBhY3JlcycgOiAnLS0nOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvcFllYXInKS50ZXh0Q29udGVudCA9IHAueWVhckJ1aWx0IHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wVHlwZScpLnRleHRDb250ZW50ID0gcC5wcm9wZXJ0eVR5cGUgfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BDb25kaXRpb24nKS50ZXh0Q29udGVudCA9IHAuY29uZGl0aW9uIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wR2FyYWdlJykudGV4dENvbnRlbnQgPSBwLmdhcmFnZSB8fCAnLS0nOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWRkaXRpb25hbCBkZXRhaWxzCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wSGVhdGluZycpLnRleHRDb250ZW50ID0gcC5oZWF0aW5nIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wQ29vbGluZycpLnRleHRDb250ZW50ID0gcC5jb29saW5nIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wU3RvcmllcycpLnRleHRDb250ZW50ID0gcC5zdG9yaWVzIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wQXR0b21JZCcpLnRleHRDb250ZW50ID0gcC5hdHRvbUlkIHx8ICctLSc7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmb3JtYXRDdXJyZW5jeSh2YWx1ZSkgewogICAgICAgICAgICBpZiAoIXZhbHVlICYmIHZhbHVlICE9PSAwKSByZXR1cm4gJy0tJzsKICAgICAgICAgICAgcmV0dXJuICckJyArIE1hdGgucm91bmQodmFsdWUpLnRvTG9jYWxlU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzaG93RXJyb3IobWVzc2FnZSkgewogICAgICAgICAgICBjb25zdCBlcnJvckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yU3RhdGUnKTsKICAgICAgICAgICAgZXJyb3JFbC50ZXh0Q29udGVudCA9ICfinYwgJyArIG1lc3NhZ2U7CiAgICAgICAgICAgIGVycm9yRWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZUNNQSgpIHsKICAgICAgICAgICAgaWYgKCFjdXJyZW50UHJvcGVydHlEYXRhKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnUGxlYXNlIGxvYWQgcHJvcGVydHkgZGF0YSBmaXJzdCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjZW50ZXJWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZW50ZXJWYWx1ZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCByYWRpdXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21hUmFkaXVzJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGRheXNCYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtYURheXNCYWNrJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGNvbXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtYUNvbXBzJykudmFsdWU7CgogICAgICAgICAgICBhbGVydChg8J+OryBDTUEgR2VuZXJhdGlvbiBSZWFkeVxuXG5Qcm9wZXJ0eTogJHtjdXJyZW50UHJvcGVydHlEYXRhLmFkZHJlc3N9XG5DZW50ZXIgVmFsdWU6ICR7Y2VudGVyVmFsdWV9XG5SYWRpdXM6ICR7cmFkaXVzfSBtaWxlc1xuRGF5cyBCYWNrOiAke2RheXNCYWNrfVxuQ29tcGFyYWJsZXM6ICR7Y29tcHN9XG5cbkludGVncmF0aW5nIHdpdGggQ2xvdWRDTUEuLi5gKTsKICAgICAgICB9CgogICAgICAgIC8vIEF1dG8tbG9hZCBvbiBwYWdlIGxvYWQgKGZvciB0ZXN0aW5nIHdpdGggcHJlcG9wdWxhdGVkIGFkZHJlc3MpCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy8gVW5jb21tZW50IHRvIGF1dG8tbG9hZCBvbiBwYWdlIGxvYWQKICAgICAgICAgICAgLy8gbG9hZFByb3BlcnR5SW50ZWwoKTsKICAgICAgICB9KTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K`;

  return {
    statusCode: 200,
    headers,
    body: Buffer.from(htmlContent, 'base64').toString('utf-8')
  };
};
