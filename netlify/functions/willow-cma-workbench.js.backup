// WILLOW V50 CMA Workbench - Complete Netlify Function
// Purpose: Server-side FUB/CloudCMA API integration with HTML serving

const https = require('https');

// API Credentials
const FUB_API_KEY = process.env.FUB_API_KEY || 'fka_0oHt62NxmsExO6x69p08ix82zx8ii1hzrj';
const CLOUDCMA_API_KEY = process.env.CLOUDCMA_API_KEY || '742f4a46e1780904da090d721a9bae7b';
const WEBHOOK_URL = 'https://willow-v50-supervised-cma.netlify.app/.netlify/functions/cloudcma-webhook';

exports.handler = async (event, context) => {
    // CORS headers
    const headers = {
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Headers': 'Content-Type',
        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
        'Content-Type': 'application/json'
    };

    if (event.httpMethod === 'OPTIONS') {
        return { statusCode: 200, headers, body: '' };
    }

    try {
        // Parse request
        const params = event.httpMethod === 'GET' 
            ? event.queryStringParameters || {}
            : JSON.parse(event.body || '{}');

        const action = params.action;

        // If no action parameter, serve HTML interface (Base64 decoded)
        if (!action) {
            const htmlBase64 = 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgdXNlci1zY2FsYWJsZT15ZXMiPgogICAgPHRpdGxlPkNNQSBXb3JrYmVuY2g8L3RpdGxlPgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iaHR0cHM6Ly9laWEuZm9sbG93dXBib3NzLmNvbS9lbWJlZGRlZEFwcHMtdjEuMC4xLmpzIj48L3NjcmlwdD4KICAgIDxzdHlsZT4KICAgICAgICAqIHsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KCiAgICAgICAgYm9keSB7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICdTZWdvZSBVSScsIFJvYm90bywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsKICAgICAgICAgICAgY29sb3I6ICMyZDM3NDg7CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjQ7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAzMHB4OwogICAgICAgIH0KCiAgICAgICAgLmNvbnRhaW5lciB7CiAgICAgICAgICAgIG1heC13aWR0aDogMTYwMHB4OwogICAgICAgICAgICBtYXJnaW46IDAgYXV0bzsKICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICB9CgogICAgICAgIC5oZWFkZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICBwYWRkaW5nOiAxNXB4IDIwcHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSk7CiAgICAgICAgfQoKICAgICAgICAuaGVhZGVyIGgxIHsKICAgICAgICAgICAgZm9udC1zaXplOiAyMHB4OwogICAgICAgICAgICBjb2xvcjogIzY2N2VlYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogM3B4OwogICAgICAgIH0KCiAgICAgICAgLmhlYWRlciAuc3VidGl0bGUgewogICAgICAgICAgICBmb250LXNpemU6IDEycHg7CiAgICAgICAgICAgIGNvbG9yOiAjNzE4MDk2OwogICAgICAgIH0KCiAgICAgICAgLyogVEFCUyAqLwogICAgICAgIC50YWJzIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZ2FwOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICAgICAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgICB9CgogICAgICAgIC50YWItYnV0dG9uIHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgbWluLXdpZHRoOiAxMjBweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgcGFkZGluZzogMTJweCAxNnB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpOwogICAgICAgICAgICBjb2xvcjogIzRhNTU2ODsKICAgICAgICB9CgogICAgICAgIC50YWItYnV0dG9uOmhvdmVyIHsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCA4cHggcmdiYSgwLDAsMCwwLjE1KTsKICAgICAgICB9CgogICAgICAgIC50YWItYnV0dG9uLmFjdGl2ZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSk7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CgogICAgICAgIC50YWItY29udGVudCB7CiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICAgICAgfQoKICAgICAgICAudGFiLWNvbnRlbnQuYWN0aXZlIHsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgfQoKICAgICAgICAud29ya2JlbmNoIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgcGFkZGluZzogMjBweDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwwLDAsMC4xKTsKICAgICAgICB9CgogICAgICAgIC8qIFBPV0VSRUQgQlkgRk9PVEVSICovCiAgICAgICAgLnBvd2VyZWQtYnkgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgIGJvdHRvbTogMTBweDsKICAgICAgICAgICAgcmlnaHQ6IDE1cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsKICAgICAgICAgICAgY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC44KTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgei1pbmRleDogMTAwMDsKICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsMCwwLDAuMyk7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC4yKTsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDEwcHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICB9CgogICAgICAgIC8qIFBST1BFUlRZIFNFTEVDVE9SICovCiAgICAgICAgLnByb3BlcnR5LWJhZGdlIHsKICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgICAgICBwYWRkaW5nOiAzcHggOHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjNjY3ZWVhOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgZm9udC1zaXplOiAxMHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICBtYXJnaW4tbGVmdDogOHB4OwogICAgICAgIH0KCiAgICAgICAgLyogREVOU0UgR1JJRCBMQVlPVVQgLSBSRVNQT05TSVZFICovCiAgICAgICAgLnByb3BlcnR5LWdyaWQgewogICAgICAgICAgICBkaXNwbGF5OiBncmlkOwogICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7CiAgICAgICAgICAgIGdhcDogMTVweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgICAgICB9CgogICAgICAgIC5zZWN0aW9uLWNvbXBhY3QgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjdmYWZjOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDEycHg7CiAgICAgICAgfQoKICAgICAgICAuc2VjdGlvbi10aXRsZS1jb21wYWN0IHsKICAgICAgICAgICAgZm9udC1zaXplOiAxM3B4OwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICBjb2xvcjogIzJkMzc0ODsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiA2cHg7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjZTJlOGYwOwogICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogNXB4OwogICAgICAgIH0KCiAgICAgICAgLyogSU5GTyBDQVJEICovCiAgICAgICAgLmluZm8tY2FyZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmN2ZhZmM7CiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzY2N2VlYTsKICAgICAgICAgICAgcGFkZGluZzogMTJweCAxNXB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgICAgIG1hcmdpbjogMTBweCAwOwogICAgICAgIH0KCiAgICAgICAgLmluZm8tY2FyZC10aXRsZSB7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIGNvbG9yOiAjMmQzNzQ4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDsKICAgICAgICB9CgogICAgICAgIC5pbmZvLWNhcmQtY29udGVudCB7CiAgICAgICAgICAgIGNvbG9yOiAjNzE4MDk2OwogICAgICAgICAgICBmb250LXNpemU6IDEycHg7CiAgICAgICAgfQoKICAgICAgICAvKiBBVk0gQ09ORklERU5DRSBCQURHRSAqLwogICAgICAgIC5hdm0taGVhZGVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgIH0KCiAgICAgICAgLmNvbmZpZGVuY2UtYmFkZ2UgewogICAgICAgICAgICBwYWRkaW5nOiAzcHggMTBweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBmb250LXNpemU6IDEwcHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjVweDsKICAgICAgICB9CgogICAgICAgIC5jb25maWRlbmNlLUhJR0ggewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjNDhiYjc4OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQoKICAgICAgICAuY29uZmlkZW5jZS1NRURJVU0gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZWQ4OTM2OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQoKICAgICAgICAuY29uZmlkZW5jZS1MT1cgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmM4MTgxOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQoKICAgICAgICAuY29uZmlkZW5jZS1VTktOT1dOIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2EwYWVjMDsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgIH0KCiAgICAgICAgLyogRURJVEFCTEUgQ0VOVEVSIFZBTFVFICovCiAgICAgICAgLnZhbHVlLWNvbnRyb2wgewogICAgICAgICAgICBkaXNwbGF5OiBncmlkOwogICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7CiAgICAgICAgICAgIGdhcDogMTBweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTJweDsKICAgICAgICB9CgogICAgICAgIC52YWx1ZS1pbnB1dC1ncm91cCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIGdhcDogNHB4OwogICAgICAgIH0KCiAgICAgICAgLnZhbHVlLWlucHV0LWxhYmVsIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjb2xvcjogIzcxODA5NjsKICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICB9CgogICAgICAgIC52YWx1ZS1pbnB1dCB7CiAgICAgICAgICAgIHBhZGRpbmc6IDhweCAxMHB4OwogICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjZTJlOGYwOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgICAgICAgY29sb3I6ICMyZDM3NDg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgIH0KCiAgICAgICAgLnZhbHVlLWlucHV0OmZvY3VzIHsKICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjNjY3ZWVhOwogICAgICAgIH0KCiAgICAgICAgLnZhbHVlLWlucHV0LnN1Z2dlc3RlZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmMGZmZjQ7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzQ4YmI3ODsKICAgICAgICB9CgogICAgICAgIC52YWx1ZS1pbnB1dC51c2VyLW92ZXJyaWRlIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZmFmMDsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjZWQ4OTM2OwogICAgICAgIH0KCiAgICAgICAgLyogREVOU0UgREFUQSBST1dTICovCiAgICAgICAgLmRhdGEtcm93IHsKICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxMDBweCAxZnI7CiAgICAgICAgICAgIGdhcDogOHB4OwogICAgICAgICAgICBwYWRkaW5nOiA1cHggMDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZGYyZjc7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICB9CgogICAgICAgIC5kYXRhLXJvdzpsYXN0LWNoaWxkIHsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogbm9uZTsKICAgICAgICB9CgogICAgICAgIC5kYXRhLWxhYmVsIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjb2xvcjogIzcxODA5NjsKICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICB9CgogICAgICAgIC5kYXRhLXZhbHVlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjb2xvcjogIzJkMzc0ODsKICAgICAgICB9CgogICAgICAgIC5kYXRhLXZhbHVlLmhpZ2hsaWdodCB7CiAgICAgICAgICAgIGNvbG9yOiAjNjY3ZWVhOwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgIH0KCiAgICAgICAgLmRhdGEtdmFsdWUud2FybmluZyB7CiAgICAgICAgICAgIGNvbG9yOiAjZWQ4OTM2OwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgIH0KCiAgICAgICAgLmRhdGEtdmFsdWUuZGFuZ2VyIHsKICAgICAgICAgICAgY29sb3I6ICNmYzgxODE7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgfQoKICAgICAgICAuZGF0YS12YWx1ZS5zdWNjZXNzIHsKICAgICAgICAgICAgY29sb3I6ICM0OGJiNzg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgfQoKICAgICAgICAvKiBDT01QQUNUIFBST1BFUlRZIENIQVJBQ1RFUklTVElDUyAqLwogICAgICAgIC5jaGFyLWdyaWQgewogICAgICAgICAgICBkaXNwbGF5OiBncmlkOwogICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCg0LCAxZnIpOwogICAgICAgICAgICBnYXA6IDhweDsKICAgICAgICAgICAgbWFyZ2luOiA4cHggMDsKICAgICAgICB9CgogICAgICAgIC5jaGFyLWl0ZW0gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2UyZThmMDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBwYWRkaW5nOiA4cHg7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICB9CgogICAgICAgIC5jaGFyLXZhbHVlIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxNXB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgICAgICBjb2xvcjogIzJkMzc0ODsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMnB4OwogICAgICAgIH0KCiAgICAgICAgLmNoYXItbGFiZWwgewogICAgICAgICAgICBmb250LXNpemU6IDlweDsKICAgICAgICAgICAgY29sb3I6ICM3MTgwOTY7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgfQoKICAgICAgICAvKiBSSVNLIEZMQUdTICovCiAgICAgICAgLnJpc2stZmxhZ3MgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgICAgICAgIGdhcDogNnB4OwogICAgICAgICAgICBtYXJnaW46IDhweCAwOwogICAgICAgIH0KCiAgICAgICAgLnJpc2stZmxhZyB7CiAgICAgICAgICAgIHBhZGRpbmc6IDNweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgZm9udC1zaXplOiA5cHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgfQoKICAgICAgICAuZmxhZy1kYW5nZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmNWY1OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZmM4MTgxOwogICAgICAgICAgICBjb2xvcjogI2M1MzAzMDsKICAgICAgICB9CgogICAgICAgIC5mbGFnLXdhcm5pbmcgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmYWYwOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZWQ4OTM2OwogICAgICAgICAgICBjb2xvcjogIzc0NDIxMDsKICAgICAgICB9CgogICAgICAgIC5mbGFnLWluZm8gewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZWJmOGZmOwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjNDI5OWUxOwogICAgICAgICAgICBjb2xvcjogIzJjNTI4MjsKICAgICAgICB9CgogICAgICAgIC5mbGFnLXN1Y2Nlc3MgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjBmZmY0OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjNDhiYjc4OwogICAgICAgICAgICBjb2xvcjogIzIyNTQzZDsKICAgICAgICB9CgogICAgICAgIC8qIEZPUk0gSU5QVVRTIC0gQ09NUEFDVCAqLwogICAgICAgIC5mb3JtLWNvbXBhY3QgewogICAgICAgICAgICBkaXNwbGF5OiBncmlkOwogICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgyLCAxZnIpOwogICAgICAgICAgICBnYXA6IDEwcHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICAgICAgfQoKICAgICAgICAuZm9ybS1ncm91cC1jb21wYWN0IHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgZ2FwOiA0cHg7CiAgICAgICAgfQoKICAgICAgICAuZm9ybS1sYWJlbC1jb21wYWN0IHsKICAgICAgICAgICAgZm9udC1zaXplOiAxMHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjb2xvcjogIzcxODA5NjsKICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICB9CgogICAgICAgIC5mb3JtLWlucHV0LWNvbXBhY3QgewogICAgICAgICAgICBwYWRkaW5nOiA4cHggMTBweDsKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgI2UyZThmMDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgfQoKICAgICAgICAuZm9ybS1pbnB1dC1jb21wYWN0OmZvY3VzIHsKICAgICAgICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiAjNjY3ZWVhOwogICAgICAgIH0KCiAgICAgICAgLmZvcm0tc2VsZWN0LWNvbXBhY3QgewogICAgICAgICAgICBwYWRkaW5nOiA4cHggMTBweDsKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgI2UyZThmMDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgfQoKICAgICAgICAuYnRuIHsKICAgICAgICAgICAgcGFkZGluZzogMTBweCAyMHB4OwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7CiAgICAgICAgfQoKICAgICAgICAuYnRuLXByaW1hcnkgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjNjY3ZWVhIDAlLCAjNzY0YmEyIDEwMCUpOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgfQoKICAgICAgICAuYnRuLXByaW1hcnk6aG92ZXIgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDhweCByZ2JhKDEwMiwgMTI2LCAyMzQsIDAuMyk7CiAgICAgICAgfQoKICAgICAgICAuYnRuLXNlY29uZGFyeSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlMmU4ZjA7CiAgICAgICAgICAgIGNvbG9yOiAjNGE1NTY4OwogICAgICAgIH0KCiAgICAgICAgLmJ0bi1zZWNvbmRhcnk6aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjY2JkNWUwOwogICAgICAgIH0KCiAgICAgICAgLmJ0bi1ncm91cCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGdhcDogMTBweDsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMTJweDsKICAgICAgICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICAgIH0KCiAgICAgICAgLmxvYWRpbmcgewogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIHBhZGRpbmc6IDMwcHg7CiAgICAgICAgICAgIGNvbG9yOiAjNzE4MDk2OwogICAgICAgIH0KCiAgICAgICAgLnNwaW5uZXIgewogICAgICAgICAgICBib3JkZXI6IDRweCBzb2xpZCAjZTJlOGYwOwogICAgICAgICAgICBib3JkZXItdG9wOiA0cHggc29saWQgIzY2N2VlYTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICB3aWR0aDogMzBweDsKICAgICAgICAgICAgaGVpZ2h0OiAzMHB4OwogICAgICAgICAgICBhbmltYXRpb246IHNwaW4gMXMgbGluZWFyIGluZmluaXRlOwogICAgICAgICAgICBtYXJnaW46IDAgYXV0byAxNXB4OwogICAgICAgIH0KCiAgICAgICAgQGtleWZyYW1lcyBzcGluIHsKICAgICAgICAgICAgMCUgeyB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTsgfQogICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsgfQogICAgICAgIH0KCiAgICAgICAgLmVycm9yIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjVmNTsKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgI2ZjODE4MTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBwYWRkaW5nOiAxMnB4OwogICAgICAgICAgICBjb2xvcjogI2M1MzAzMDsKICAgICAgICAgICAgbWFyZ2luOiAxMnB4IDA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICB9CgogICAgICAgIC5zdWNjZXNzIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2YwZmZmNDsKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgIzY4ZDM5MTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBwYWRkaW5nOiAxMnB4OwogICAgICAgICAgICBjb2xvcjogIzIyNTQzZDsKICAgICAgICAgICAgbWFyZ2luOiAxMnB4IDA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICB9CgogICAgICAgIC8qIENPTExBUFNJQkxFIFNFQ1RJT05TICovCiAgICAgICAgLmNvbGxhcHNpYmxlIHsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZ2FwOiA2cHg7CiAgICAgICAgfQoKICAgICAgICAuY29sbGFwc2libGU6OmJlZm9yZSB7CiAgICAgICAgICAgIGNvbnRlbnQ6ICfilrwnOwogICAgICAgICAgICBmb250LXNpemU6IDlweDsKICAgICAgICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuM3MgZWFzZTsKICAgICAgICB9CgogICAgICAgIC5jb2xsYXBzaWJsZS5jb2xsYXBzZWQ6OmJlZm9yZSB7CiAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC05MGRlZyk7CiAgICAgICAgfQoKICAgICAgICAuY29sbGFwc2libGUtY29udGVudCB7CiAgICAgICAgICAgIG1heC1oZWlnaHQ6IDIwMDBweDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgdHJhbnNpdGlvbjogbWF4LWhlaWdodCAwLjNzIGVhc2U7CiAgICAgICAgfQoKICAgICAgICAuY29sbGFwc2libGUtY29udGVudC5oaWRkZW4gewogICAgICAgICAgICBtYXgtaGVpZ2h0OiAwOwogICAgICAgIH0KCiAgICAgICAgLyogTU9CSUxFIFJFU1BPTlNJVkUgLSBUT1VDSCBGUklFTkRMWSAqLwogICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogICAgICAgICAgICBib2R5IHsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgICAgIHRvdWNoLWFjdGlvbjogbWFuaXB1bGF0aW9uOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAucHJvcGVydHktZ3JpZCB7CiAgICAgICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmcjsKICAgICAgICAgICAgICAgIGdhcDogMTJweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLmNoYXItZ3JpZCB7CiAgICAgICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgyLCAxZnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAuZm9ybS1jb21wYWN0IHsKICAgICAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAuY29udGFpbmVyIHsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC53b3JrYmVuY2ggewogICAgICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLnZhbHVlLWNvbnRyb2wgewogICAgICAgICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC50YWItYnV0dG9uIHsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHggMTJweDsKICAgICAgICAgICAgICAgIG1pbi13aWR0aDogOTBweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLmJ0biB7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMnB4IDIwcHg7CiAgICAgICAgICAgICAgICBmb250LXNpemU6IDE1cHg7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLmJ0bi1ncm91cCB7CiAgICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAuZm9ybS1pbnB1dC1jb21wYWN0LAogICAgICAgICAgICAuZm9ybS1zZWxlY3QtY29tcGFjdCwKICAgICAgICAgICAgLnZhbHVlLWlucHV0IHsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHggMTJweDsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLmRhdGEtcm93IHsKICAgICAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogOTBweCAxZnI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgogICAgICAgICAgICA8aDE+8J+OryBDTUEgV29ya2JlbmNoPC9oMT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3VidGl0bGUiPkFUVE9NIEludGVsbGlnZW5jZSB8IExlYWQ6IDxzcGFuIGlkPSJsZWFkTmFtZSI+TG9hZGluZy4uLjwvc3Bhbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPCEtLSBUQUJTIC0tPgogICAgICAgIDxkaXYgY2xhc3M9InRhYnMiPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ0YWItYnV0dG9uIGFjdGl2ZSIgb25jbGljaz0ic3dpdGNoVGFiKCdwcm9wZXJ0eS1pbnRlbCcpIj4KICAgICAgICAgICAgICAgIPCfk4ogUHJvcGVydHkgSW50ZWwKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhYi1idXR0b24iIG9uY2xpY2s9InN3aXRjaFRhYignY21hLWdlbmVyYXRvcicpIj4KICAgICAgICAgICAgICAgIPCfj6AgQ01BIEdlbmVyYXRvcgogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ1dHRvbiIgb25jbGljaz0ic3dpdGNoVGFiKCdjb21wYXJhYmxlcycpIj4KICAgICAgICAgICAgICAgIPCfk4ggQ29tcGFyYWJsZXMKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9IndvcmtiZW5jaCI+CiAgICAgICAgICAgIDwhLS0gVEFCIDE6IFBST1BFUlRZIElOVEVMTElHRU5DRSAtLT4KICAgICAgICAgICAgPGRpdiBpZD0icHJvcGVydHktaW50ZWwiIGNsYXNzPSJ0YWItY29udGVudCBhY3RpdmUiPgogICAgICAgICAgICAgICAgPCEtLSBQUk9QRVJUWSBTRUxFQ1RPUiAoc2hvd24gaWYgbXVsdGlwbGUgcHJvcGVydGllcykgLS0+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJwcm9wZXJ0eVNlbGVjdG9yIiBjbGFzcz0ic2VjdGlvbi1jb21wYWN0IiBzdHlsZT0iZGlzcGxheTogbm9uZTsgbWFyZ2luLWJvdHRvbTogMTVweDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUtY29tcGFjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgIPCfj5jvuI8gU2VsZWN0IFByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJwcm9wZXJ0eUNvdW50IiBjbGFzcz0icHJvcGVydHktYmFkZ2UiPjAgcHJvcGVydGllczwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJwcm9wZXJ0eURyb3Bkb3duIiBjbGFzcz0iZm9ybS1zZWxlY3QtY29tcGFjdCIgb25jaGFuZ2U9ImxvYWRTZWxlY3RlZFByb3BlcnR5KCkiPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPi0tIFNlbGVjdCBhIHByb3BlcnR5IC0tPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zZWNvbmRhcnkiIG9uY2xpY2s9InNob3dNYW51YWxFbnRyeSgpIiBzdHlsZT0ibWFyZ2luLXRvcDogMTBweDsgd2lkdGg6IDEwMCU7Ij4KICAgICAgICAgICAgICAgICAgICAgICAg4p6VIEFkZCBOZXcgUHJvcGVydHkKICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgIDwhLS0gU0VDVElPTiAxOiBTVUJKRUNUIFBST1BFUlRZIEFERFJFU1MgLS0+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJtYW51YWxBZGRyZXNzU2VjdGlvbiIgY2xhc3M9InNlY3Rpb24tY29tcGFjdCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZS1jb21wYWN0Ij7wn5ONIFN1YmplY3QgUHJvcGVydHkgQWRkcmVzczwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAtY29tcGFjdCIgc3R5bGU9ImdyaWQtY29sdW1uOiAxIC8gLTE7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmb3JtLWxhYmVsLWNvbXBhY3QiPkZ1bGwgQWRkcmVzcyAoQ2l0eSwgU3RhdGUsIFpJUCByZXF1aXJlZCk8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0ZXh0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkPSJzdWJqZWN0QWRkcmVzcyIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0iZm9ybS1pbnB1dC1jb21wYWN0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSIxMjMgTWFpbiBTdCwgUG91Z2hrZWVwc2llLCBOWSAxMjYwMSIKICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tcHJpbWFyeSIgb25jbGljaz0ibG9hZFByb3BlcnR5RGF0YSgpIiBzdHlsZT0ibWFyZ2luLXRvcDogMTBweDsgd2lkdGg6IDEwMCU7Ij4KICAgICAgICAgICAgICAgICAgICAgICAg8J+UjSBMb2FkIEFUVE9NIEludGVsbGlnZW5jZQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBpZD0ibG9hZGluZ0luZGljYXRvciIgY2xhc3M9ImxvYWRpbmciIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdj5Mb2FkaW5nIHByb3BlcnR5IGludGVsbGlnZW5jZS4uLjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBpZD0iZXJyb3JNZXNzYWdlIiBjbGFzcz0iZXJyb3IiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+PC9kaXY+CgogICAgICAgICAgICAgICAgPCEtLSBQUk9QRVJUWSBJTlRFTExJR0VOQ0UgR1JJRCAoSGlkZGVuIHVudGlsIGRhdGEgbG9hZGVkKSAtLT4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9InByb3BlcnR5SW50ZWxsaWdlbmNlIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWdyaWQiPgogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIExFRlQgQ09MVU1OOiBBVk0gJiBWQUxVQVRJT04gLS0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tY29tcGFjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhdm0taGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlLWNvbXBhY3QiPvCfkrAgQVZNPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImF2bUNvbmZpZGVuY2VCYWRnZSIgY2xhc3M9ImNvbmZpZGVuY2UtYmFkZ2UgY29uZmlkZW5jZS1VTktOT1dOIj5VTktOT1dOPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBFRElUQUJMRSBDRU5URVIgVkFMVUUgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2YWx1ZS1jb250cm9sIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2YWx1ZS1pbnB1dC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0idmFsdWUtaW5wdXQtbGFiZWwiPkFUVE9NIFN1Z2dlc3RlZDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9InRleHQiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9ImF2bVN1Z2dlc3RlZFZhbHVlIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJ2YWx1ZS1pbnB1dCBzdWdnZXN0ZWQiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZG9ubHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSIkMCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZhbHVlLWlucHV0LWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJ2YWx1ZS1pbnB1dC1sYWJlbCI+WW91ciBDZW50ZXIgVmFsdWU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0ZXh0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkPSJjZW50ZXJWYWx1ZSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0idmFsdWUtaW5wdXQgdXNlci1vdmVycmlkZSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iT3ZlcnJpZGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZT0idXBkYXRlQ2VudGVyVmFsdWUoKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5Db25maWRlbmNlPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJhdm1TY29yZSIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPlJhbmdlPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJhdm1SYW5nZSIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPkFWTSBEYXRlPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJhdm1EYXRlIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIFJJR0hUIENPTFVNTjogU0FMRVMgSElTVE9SWSAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi1jb21wYWN0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUtY29tcGFjdCI+8J+TiCBTYWxlcyAmIFZlbG9jaXR5PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPkxhc3QgU2FsZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ibGFzdFNhbGVEYXRlIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+U2FsZSBQcmljZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ibGFzdFNhbGVQcmljZSIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPlByaWNlL1NxRnQ8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9InByaWNlUGVyU3FmdCIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPkFwcHJlY2lhdGlvbjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iYXBwcmVjaWF0aW9uIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+VmVsb2NpdHk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9Im1hcmtldFZlbG9jaXR5IiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gUFJPUEVSVFkgQ0hBUkFDVEVSSVNUSUNTIC0gQ09NUEFDVCAtLT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLWNvbXBhY3QiIHN0eWxlPSJtYXJnaW4tYm90dG9tOiAxNXB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUtY29tcGFjdCI+8J+PoCBQcm9wZXJ0eSBDaGFyYWN0ZXJpc3RpY3M8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhci1ncmlkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iY2hhckJlZHMiIGNsYXNzPSJjaGFyLXZhbHVlIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItbGFiZWwiPkJlZHM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhci1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjaGFyQmF0aHMiIGNsYXNzPSJjaGFyLXZhbHVlIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItbGFiZWwiPkJhdGhzPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iY2hhclNxZnQiIGNsYXNzPSJjaGFyLXZhbHVlIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItbGFiZWwiPlNxRnQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhci1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjaGFyQWNyZXMiIGNsYXNzPSJjaGFyLXZhbHVlIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItbGFiZWwiPkFjcmVzPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iY2hhckdhcmFnZSIgY2xhc3M9ImNoYXItdmFsdWUiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhci1sYWJlbCI+R2FyYWdlPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItaXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iY2hhclR5cGUiIGNsYXNzPSJjaGFyLXZhbHVlIj4tLTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXItbGFiZWwiPlR5cGU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhci1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjaGFyWWVhciIgY2xhc3M9ImNoYXItdmFsdWUiPi0tPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhci1sYWJlbCI+QnVpbHQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhci1pdGVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjaGFyQ29uZGl0aW9uIiBjbGFzcz0iY2hhci12YWx1ZSI+LS08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFyLWxhYmVsIj5Db25kaXRpb248L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPCEtLSBFUVVJVFkgJiBPV05FUiBJTlRFTExJR0VOQ0UgLS0+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvcGVydHktZ3JpZCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tY29tcGFjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlLWNvbXBhY3QiPvCfkrUgRXF1aXR5IEludGVsbGlnZW5jZTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5FcXVpdHkgJDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZXF1aXR5RG9sbGFycyIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPkVxdWl0eSAlPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJlcXVpdHlQZXJjZW50IiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+TFRWIFJhdGlvPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJsdHZSYXRpbyIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPlN0YXR1czwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZXF1aXR5U3RhdHVzIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLWNvbXBhY3QiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZS1jb21wYWN0Ij7wn5GkIE93bmVyIEludGVsPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPk93bmVyPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJvd25lck5hbWUiIGNsYXNzPSJkYXRhLXZhbHVlIj4tLTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5UeXBlPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJvd25lclR5cGUiIGNsYXNzPSJkYXRhLXZhbHVlIj4tLTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5ZZWFycyBPd25lZDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ib3duZXJzaGlwTGVuZ3RoIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9Im93bmVyRmxhZ3MiIGNsYXNzPSJyaXNrLWZsYWdzIiBzdHlsZT0ibWFyZ2luLXRvcDogNnB4OyI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8IS0tIFJJU0sgJiBFTlZJUk9OTUVOVEFMIC0tPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb3BlcnR5LWdyaWQiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLWNvbXBhY3QiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZS1jb21wYWN0Ij7wn4yNIEVudmlyb25tZW50YWw8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+Rmxvb2QgWm9uZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZmxvb2Rab25lIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+Rmxvb2QgUmlzazwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZmxvb2RSaXNrIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImVudmlyb25tZW50YWxGbGFncyIgY2xhc3M9InJpc2stZmxhZ3MiIHN0eWxlPSJtYXJnaW4tdG9wOiA2cHg7Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLWNvbXBhY3QiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZS1jb21wYWN0Ij7wn4+rIFNjaG9vbHM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+RGlzdHJpY3Q8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9InNjaG9vbERpc3RyaWN0IiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+RWxlbWVudGFyeTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic2Nob29sRWxlbWVudGFyeSIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPkhpZ2ggU2Nob29sPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJzY2hvb2xIaWdoIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gRElTVFJFU1MgRkxBR1MgKElmIGFueSkgLS0+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iZGlzdHJlc3NTZWN0aW9uIiBjbGFzcz0ic2VjdGlvbi1jb21wYWN0IiBzdHlsZT0iZGlzcGxheTogbm9uZTsgbWFyZ2luLWJvdHRvbTogMTVweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlLWNvbXBhY3QiPuKaoO+4jyBEaXN0cmVzcyBJbmRpY2F0b3JzPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImRpc3RyZXNzRmxhZ3MiIGNsYXNzPSJyaXNrLWZsYWdzIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iZGlzdHJlc3NEZXRhaWxzIiBzdHlsZT0ibWFyZ2luLXRvcDogOHB4OyBmb250LXNpemU6IDExcHg7IGNvbG9yOiAjNGE1NTY4OyI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDwhLS0gQ09MTEFQU0lCTEU6IEFERElUSU9OQUwgREVUQUlMUyAtLT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLWNvbXBhY3QiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlLWNvbXBhY3QgY29sbGFwc2libGUiIG9uY2xpY2s9InRvZ2dsZUNvbGxhcHNpYmxlKCdhZGRpdGlvbmFsRGV0YWlscycpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIPCfk4sgQWRkaXRpb25hbCBEZXRhaWxzCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJhZGRpdGlvbmFsRGV0YWlscyIgY2xhc3M9ImNvbGxhcHNpYmxlLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5TdG9yaWVzPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJkZXRhaWxTdG9yaWVzIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+UXVhbGl0eTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZGV0YWlsUXVhbGl0eSIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPlBvb2w8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImRldGFpbFBvb2wiIGNsYXNzPSJkYXRhLXZhbHVlIj4tLTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5GaXJlcGxhY2U8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImRldGFpbEZpcmVwbGFjZSIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXRhLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImRhdGEtbGFiZWwiPkhlYXRpbmc8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImRldGFpbEhlYXRpbmciIGNsYXNzPSJkYXRhLXZhbHVlIj4tLTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5Db29saW5nPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJkZXRhaWxDb29saW5nIiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+VGF4IEFtb3VudDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZGV0YWlsVGF4QW1vdW50IiBjbGFzcz0iZGF0YS12YWx1ZSI+LS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhdGEtcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1sYWJlbCI+VGF4L1NxRnQ8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImRldGFpbFRheFBlclNxZnQiIGNsYXNzPSJkYXRhLXZhbHVlIj4tLTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF0YS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXRhLWxhYmVsIj5BVFRPTSBJRDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZGV0YWlsQXR0b21JZCIgY2xhc3M9ImRhdGEtdmFsdWUiPi0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPCEtLSBUQUIgMjogQ01BIEdFTkVSQVRPUiAtLT4KICAgICAgICAgICAgPGRpdiBpZD0iY21hLWdlbmVyYXRvciIgY2xhc3M9InRhYi1jb250ZW50Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tY29tcGFjdCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZS1jb21wYWN0Ij7wn5OKIEdlbmVyYXRlIENNQSBSZXBvcnQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWNvbXBhY3QiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwLWNvbXBhY3QiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmb3JtLWxhYmVsLWNvbXBhY3QiPlNlYXJjaCBSYWRpdXMgKG1pbGVzKTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iY21hUmFkaXVzIiBjbGFzcz0iZm9ybS1pbnB1dC1jb21wYWN0IiB2YWx1ZT0iMyIgbWluPSIxIiBtYXg9IjEwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAtY29tcGFjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImZvcm0tbGFiZWwtY29tcGFjdCI+RGF5cyBCYWNrPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJjbWFEYXlzQmFjayIgY2xhc3M9ImZvcm0taW5wdXQtY29tcGFjdCIgdmFsdWU9IjE4MCIgbWluPSIzMCIgbWF4PSI3MzAiPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cC1jb21wYWN0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZm9ybS1sYWJlbC1jb21wYWN0Ij5NYXggQ29tcGFyYWJsZXM8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImNtYU1heENvbXBzIiBjbGFzcz0iZm9ybS1pbnB1dC1jb21wYWN0IiB2YWx1ZT0iMTAiIG1pbj0iMyIgbWF4PSIyMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwLWNvbXBhY3QiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmb3JtLWxhYmVsLWNvbXBhY3QiPlByaWNlIFZhcmlhbmNlICglKTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iY21hUHJpY2VWYXJpYW5jZSIgY2xhc3M9ImZvcm0taW5wdXQtY29tcGFjdCIgdmFsdWU9IjI1IiBtaW49IjEwIiBtYXg9IjUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYnRuLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBvbmNsaWNrPSJnZW5lcmF0ZUNNQSgpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIPCfk4ogR2VuZXJhdGUgQ01BIFJlcG9ydAogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zZWNvbmRhcnkiIG9uY2xpY2s9ImV4cG9ydERhdGEoKSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICDwn5K+IEV4cG9ydCB0byBGVUIKICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8IS0tIFRBQiAzOiBDT01QQVJBQkxFUyAoUExBQ0VIT0xERVIpIC0tPgogICAgICAgICAgICA8ZGl2IGlkPSJjb21wYXJhYmxlcyIgY2xhc3M9InRhYi1jb250ZW50Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tY29tcGFjdCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZS1jb21wYWN0Ij7wn5OIIENvbXBhcmFibGUgUHJvcGVydGllczwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImluZm8tY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImluZm8tY2FyZC10aXRsZSI+Q29taW5nIFNvb248L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5mby1jYXJkLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyB0YWIgd2lsbCBkaXNwbGF5IGNvbXBhcmFibGUgcHJvcGVydGllcyBmcm9tIENsb3VkQ01BIGFmdGVyIENNQSBnZW5lcmF0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDwhLS0gUG93ZXJlZCBCeSBGb290ZXIgLS0+CiAgICA8ZGl2IGNsYXNzPSJwb3dlcmVkLWJ5Ij5Qb3dlcmVkIGJ5IFdJTExPVzwvZGl2PgoKICAgIDxzY3JpcHQ+CiAgICAgICAgbGV0IGN1cnJlbnRQcm9wZXJ0eURhdGEgPSBudWxsOwogICAgICAgIGxldCBmdWJDb250ZXh0ID0gbnVsbDsKICAgICAgICBsZXQgZGV0ZWN0ZWRQcm9wZXJ0aWVzID0gW107CiAgICAgICAgbGV0IGNtYUhpc3RvcnkgPSBbXTsKCiAgICAgICAgLy8gSW5pdGlhbGl6ZSBGVUIgZW1iZWRkZWQgYXBwCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBhc3luYyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZ1YkNvbnRleHQgPSBhd2FpdCBGVUIuZ2V0Q29udGV4dCgpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZVQiBDb250ZXh0OicsIGZ1YkNvbnRleHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoZnViQ29udGV4dCAmJiBmdWJDb250ZXh0LnBlcnNvbikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWFkTmFtZScpLnRleHRDb250ZW50ID0gCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1YkNvbnRleHQucGVyc29uLm5hbWUgfHwgJ1Vua25vd24gTGVhZCc7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRGV0ZWN0IG11bHRpcGxlIHByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICBhd2FpdCBkZXRlY3RQcm9wZXJ0aWVzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBGVUIgY29udGV4dDonLCBlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gRGV0ZWN0IHByb3BlcnRpZXMgZnJvbSBGVUIgcmVjb3JkCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZGV0ZWN0UHJvcGVydGllcygpIHsKICAgICAgICAgICAgaWYgKCFmdWJDb250ZXh0IHx8ICFmdWJDb250ZXh0LnBlcnNvbikgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgcGVyc29uID0gZnViQ29udGV4dC5wZXJzb247CiAgICAgICAgICAgIGNvbnN0IGFkZHJlc3NlcyA9IFtdOwoKICAgICAgICAgICAgLy8gMS4gU2NhbiBzdGFuZGFyZCBGVUIgYWRkcmVzcyBmaWVsZHMKICAgICAgICAgICAgaWYgKHBlcnNvbi5hZGRyZXNzZXMgJiYgQXJyYXkuaXNBcnJheShwZXJzb24uYWRkcmVzc2VzKSkgewogICAgICAgICAgICAgICAgcGVyc29uLmFkZHJlc3Nlcy5mb3JFYWNoKGFkZHIgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChhZGRyLnN0cmVldCAmJiBhZGRyLmNpdHkgJiYgYWRkci5zdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdWxsQWRkciA9IGAke2FkZHIuc3RyZWV0fSwgJHthZGRyLmNpdHl9LCAke2FkZHIuc3RhdGV9ICR7YWRkci56aXAgfHwgJyd9YC50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3Nlcy5wdXNoKGZ1bGxBZGRyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4gU2NhbiBXSUxMT1cgQ01BIGhpc3RvcnkgYWRkcmVzcwogICAgICAgICAgICBpZiAocGVyc29uLmN1c3RvbVdJTExPV0NNQUFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIGFkZHJlc3Nlcy5wdXNoKHBlcnNvbi5jdXN0b21XSUxMT1dDTUFBZGRyZXNzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMy4gU2NhbiBGZWxsbyBwcm9wZXJ0eSBhZGRyZXNzZXMgKGlmIGF2YWlsYWJsZSkKICAgICAgICAgICAgaWYgKHBlcnNvbi5jdXN0b21GZWxsb1Byb3BlcnR5QWRkcmVzcykgewogICAgICAgICAgICAgICAgYWRkcmVzc2VzLnB1c2gocGVyc29uLmN1c3RvbUZlbGxvUHJvcGVydHlBZGRyZXNzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gNC4gUGFyc2UgQ01BIGhpc3RvcnkgZnJvbSBub3RlcyAoaWYgYXZhaWxhYmxlKQogICAgICAgICAgICBhd2FpdCBwYXJzZUNNQUhpc3RvcnlGcm9tTm90ZXMoKTsKCiAgICAgICAgICAgIC8vIERlZHVwbGljYXRlIGFkZHJlc3NlcwogICAgICAgICAgICBkZXRlY3RlZFByb3BlcnRpZXMgPSBbLi4ubmV3IFNldChhZGRyZXNzZXMpXS5maWx0ZXIoYWRkciA9PiBhZGRyICYmIGFkZHIubGVuZ3RoID4gMTApOwoKICAgICAgICAgICAgY29uc29sZS5sb2coJ0RldGVjdGVkIHByb3BlcnRpZXM6JywgZGV0ZWN0ZWRQcm9wZXJ0aWVzKTsKCiAgICAgICAgICAgIC8vIFNob3cgcHJvcGVydHkgc2VsZWN0b3IgaWYgbXVsdGlwbGUgcHJvcGVydGllcwogICAgICAgICAgICBpZiAoZGV0ZWN0ZWRQcm9wZXJ0aWVzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIHNob3dQcm9wZXJ0eVNlbGVjdG9yKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGV0ZWN0ZWRQcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgLy8gQXV0by1maWxsIHNpbmdsZSBwcm9wZXJ0eQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1YmplY3RBZGRyZXNzJykudmFsdWUgPSBkZXRlY3RlZFByb3BlcnRpZXNbMF07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFBhcnNlIENNQSBoaXN0b3J5IGZyb20gRlVCIG5vdGVzCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gcGFyc2VDTUFIaXN0b3J5RnJvbU5vdGVzKCkgewogICAgICAgICAgICAvLyBUT0RPOiBJbXBsZW1lbnQgbm90ZSBwYXJzaW5nIHdoZW4gYXZhaWxhYmxlCiAgICAgICAgICAgIC8vIFdpbGwgbG9vayBmb3Igc3RydWN0dXJlZCBDTUEgaGlzdG9yeSBpbiBub3RlcwogICAgICAgIH0KCiAgICAgICAgLy8gU2hvdyBwcm9wZXJ0eSBzZWxlY3RvciBkcm9wZG93bgogICAgICAgIGZ1bmN0aW9uIHNob3dQcm9wZXJ0eVNlbGVjdG9yKCkgewogICAgICAgICAgICBjb25zdCBzZWxlY3RvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wZXJ0eVNlbGVjdG9yJyk7CiAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BlcnR5RHJvcGRvd24nKTsKICAgICAgICAgICAgY29uc3QgY291bnRCYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wZXJ0eUNvdW50Jyk7CgogICAgICAgICAgICAvLyBDbGVhciBleGlzdGluZyBvcHRpb25zCiAgICAgICAgICAgIGRyb3Bkb3duLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIFNlbGVjdCBhIHByb3BlcnR5IC0tPC9vcHRpb24+JzsKCiAgICAgICAgICAgIC8vIEFkZCBkZXRlY3RlZCBwcm9wZXJ0aWVzCiAgICAgICAgICAgIGRldGVjdGVkUHJvcGVydGllcy5mb3JFYWNoKChhZGRyLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgICAgICAgICBvcHRpb24udmFsdWUgPSBhZGRyOwogICAgICAgICAgICAgICAgb3B0aW9uLnRleHRDb250ZW50ID0gYWRkcjsKICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFwcGVuZENoaWxkKG9wdGlvbik7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gVXBkYXRlIGNvdW50IGJhZGdlCiAgICAgICAgICAgIGNvdW50QmFkZ2UudGV4dENvbnRlbnQgPSBgJHtkZXRlY3RlZFByb3BlcnRpZXMubGVuZ3RofSBwcm9wZXJ0aWVzYDsKCiAgICAgICAgICAgIC8vIFNob3cgc2VsZWN0b3IKICAgICAgICAgICAgc2VsZWN0b3Iuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICAvLyBMb2FkIHNlbGVjdGVkIHByb3BlcnR5IGZyb20gZHJvcGRvd24KICAgICAgICBmdW5jdGlvbiBsb2FkU2VsZWN0ZWRQcm9wZXJ0eSgpIHsKICAgICAgICAgICAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvcGVydHlEcm9wZG93bicpOwogICAgICAgICAgICBjb25zdCBzZWxlY3RlZEFkZHJlc3MgPSBkcm9wZG93bi52YWx1ZTsKCiAgICAgICAgICAgIGlmIChzZWxlY3RlZEFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJqZWN0QWRkcmVzcycpLnZhbHVlID0gc2VsZWN0ZWRBZGRyZXNzOwogICAgICAgICAgICAgICAgbG9hZFByb3BlcnR5RGF0YSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBTaG93IG1hbnVhbCBhZGRyZXNzIGVudHJ5CiAgICAgICAgZnVuY3Rpb24gc2hvd01hbnVhbEVudHJ5KCkgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3ViamVjdEFkZHJlc3MnKS52YWx1ZSA9ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3ViamVjdEFkZHJlc3MnKS5mb2N1cygpOwogICAgICAgIH0KCiAgICAgICAgLy8gU3dpdGNoIGJldHdlZW4gdGFicwogICAgICAgIGZ1bmN0aW9uIHN3aXRjaFRhYih0YWJJZCkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudGFiLWNvbnRlbnQnKS5mb3JFYWNoKHRhYiA9PiB7CiAgICAgICAgICAgICAgICB0YWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYi1idXR0b24nKS5mb3JFYWNoKGJ1dHRvbiA9PiB7CiAgICAgICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFiSWQpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBMb2FkIHByb3BlcnR5IGRhdGEgZnJvbSBBVFRPTSBBUEkKICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2FkUHJvcGVydHlEYXRhKCkgewogICAgICAgICAgICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1YmplY3RBZGRyZXNzJykudmFsdWUudHJpbSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFhZGRyZXNzKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnUGxlYXNlIGVudGVyIGEgcHJvcGVydHkgYWRkcmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ0luZGljYXRvcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JNZXNzYWdlJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb3BlcnR5SW50ZWxsaWdlbmNlJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwZXJzb25JZCA9IGZ1YkNvbnRleHQ/LnBlcnNvbj8uaWQgfHwgbnVsbDsKICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGAvLm5ldGxpZnkvZnVuY3Rpb25zL2F0dG9tLXByb3BlcnR5LWxvb2t1cD9hZGRyZXNzPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGFkZHJlc3MpfSR7cGVyc29uSWQgPyAnJnBlcnNvbklkPScgKyBwZXJzb25JZCA6ICcnfWA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKCiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rIHx8ICFyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGxvYWQgcHJvcGVydHkgZGF0YScpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGN1cnJlbnRQcm9wZXJ0eURhdGEgPSByZXN1bHQuZGF0YTsKICAgICAgICAgICAgICAgIGN1cnJlbnRQcm9wZXJ0eURhdGEuYWRkcmVzc19xdWVyaWVkID0gYWRkcmVzczsgLy8gU3RvcmUgcXVlcmllZCBhZGRyZXNzCiAgICAgICAgICAgICAgICBkaXNwbGF5UHJvcGVydHlEYXRhKGN1cnJlbnRQcm9wZXJ0eURhdGEpOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nSW5kaWNhdG9yJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9wZXJ0eUludGVsbGlnZW5jZScpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwoKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgcHJvcGVydHkgZGF0YTonLCBlcnJvcik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ0luZGljYXRvcicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JNZXNzYWdlJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJyb3JNZXNzYWdlJykudGV4dENvbnRlbnQgPSAKICAgICAgICAgICAgICAgICAgICAnRXJyb3I6ICcgKyBlcnJvci5tZXNzYWdlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBEaXNwbGF5IHByb3BlcnR5IGRhdGEgaW4gVUkKICAgICAgICBmdW5jdGlvbiBkaXNwbGF5UHJvcGVydHlEYXRhKGRhdGEpIHsKICAgICAgICAgICAgLy8gQVZNIFNlY3Rpb24KICAgICAgICAgICAgaWYgKGRhdGEuYXZtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdWdnZXN0ZWRWYWx1ZSA9IGRhdGEuYXZtLnZhbHVlIHx8IDA7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZtU3VnZ2VzdGVkVmFsdWUnKS52YWx1ZSA9IGZvcm1hdEN1cnJlbmN5KHN1Z2dlc3RlZFZhbHVlKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZW50ZXJWYWx1ZScpLnZhbHVlID0gZm9ybWF0Q3VycmVuY3koc3VnZ2VzdGVkVmFsdWUpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NlbnRlclZhbHVlJykucGxhY2Vob2xkZXIgPSBmb3JtYXRDdXJyZW5jeShzdWdnZXN0ZWRWYWx1ZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdm1TY29yZScpLnRleHRDb250ZW50ID0gZGF0YS5hdm0uY29uZmlkZW5jZVNjb3JlIHx8ICctLSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZtQ29uZmlkZW5jZUJhZGdlJykudGV4dENvbnRlbnQgPSBkYXRhLmF2bS5jb25maWRlbmNlTGV2ZWwgfHwgJ1VOS05PV04nOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2bUNvbmZpZGVuY2VCYWRnZScpLmNsYXNzTmFtZSA9IAogICAgICAgICAgICAgICAgICAgICdjb25maWRlbmNlLWJhZGdlIGNvbmZpZGVuY2UtJyArIChkYXRhLmF2bS5jb25maWRlbmNlTGV2ZWwgfHwgJ1VOS05PV04nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2bVJhbmdlJykudGV4dENvbnRlbnQgPSAKICAgICAgICAgICAgICAgICAgICBgJHtmb3JtYXRDdXJyZW5jeShkYXRhLmF2bS52YWx1ZUxvdyl9IC0gJHtmb3JtYXRDdXJyZW5jeShkYXRhLmF2bS52YWx1ZUhpZ2gpfWA7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZtRGF0ZScpLnRleHRDb250ZW50ID0gCiAgICAgICAgICAgICAgICAgICAgZGF0YS5hdm0uZGF0ZSA/IG5ldyBEYXRlKGRhdGEuYXZtLmRhdGUpLnRvTG9jYWxlRGF0ZVN0cmluZygpIDogJy0tJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2FsZXMgSGlzdG9yeQogICAgICAgICAgICBpZiAoZGF0YS5zYWxlSGlzdG9yeSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhc3RTYWxlRGF0ZScpLnRleHRDb250ZW50ID0gCiAgICAgICAgICAgICAgICAgICAgZGF0YS5zYWxlSGlzdG9yeS5sYXN0U2FsZURhdGUgPyBuZXcgRGF0ZShkYXRhLnNhbGVIaXN0b3J5Lmxhc3RTYWxlRGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKCkgOiAnLS0nOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhc3RTYWxlUHJpY2UnKS50ZXh0Q29udGVudCA9IAogICAgICAgICAgICAgICAgICAgIGZvcm1hdEN1cnJlbmN5KGRhdGEuc2FsZUhpc3RvcnkubGFzdFNhbGVQcmljZSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpY2VQZXJTcWZ0JykudGV4dENvbnRlbnQgPSAKICAgICAgICAgICAgICAgICAgICBkYXRhLnNhbGVIaXN0b3J5LnByaWNlUGVyU3FmdCA/ICckJyArIGRhdGEuc2FsZUhpc3RvcnkucHJpY2VQZXJTcWZ0IDogJy0tJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGRhdGEuc2FsZUhpc3RvcnkuYXBwcmVjaWF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXBwRG9sbGFycyA9IGRhdGEuc2FsZUhpc3RvcnkuYXBwcmVjaWF0aW9uLmRvbGxhcnM7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXBwUGVyY2VudCA9IGRhdGEuc2FsZUhpc3RvcnkuYXBwcmVjaWF0aW9uLnBlcmNlbnRhZ2U7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcHJlY2lhdGlvbicpLmlubmVySFRNTCA9IAogICAgICAgICAgICAgICAgICAgICAgICBgPHNwYW4gY2xhc3M9IiR7YXBwRG9sbGFycyA+PSAwID8gJ3N1Y2Nlc3MnIDogJ2Rhbmdlcid9Ij4ke2Zvcm1hdEN1cnJlbmN5KGFwcERvbGxhcnMpfSAoJHthcHBQZXJjZW50fSUpPC9zcGFuPmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHZlbG9jaXR5ID0gZGF0YS5zYWxlSGlzdG9yeS5tYXJrZXRWZWxvY2l0eSB8fCAnVU5LTk9XTic7CiAgICAgICAgICAgICAgICBjb25zdCB2ZWxvY2l0eUNsYXNzID0gdmVsb2NpdHkgPT09ICdIT1QnID8gJ2RhbmdlcicgOiB2ZWxvY2l0eSA9PT0gJ1dBUk0nID8gJ3dhcm5pbmcnIDogJ2hpZ2hsaWdodCc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFya2V0VmVsb2NpdHknKS5pbm5lckhUTUwgPSAKICAgICAgICAgICAgICAgICAgICBgPHNwYW4gY2xhc3M9IiR7dmVsb2NpdHlDbGFzc30iPiR7dmVsb2NpdHl9PC9zcGFuPmA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFByb3BlcnR5IENoYXJhY3RlcmlzdGljcwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhckJlZHMnKS50ZXh0Q29udGVudCA9IGRhdGEuYmVkcyB8fCAnLS0nOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhckJhdGhzJykudGV4dENvbnRlbnQgPSBkYXRhLmJhdGhzIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFyU3FmdCcpLnRleHRDb250ZW50ID0gZGF0YS5zcWZ0ID8gZGF0YS5zcWZ0LnRvTG9jYWxlU3RyaW5nKCkgOiAnLS0nOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhckFjcmVzJykudGV4dENvbnRlbnQgPSBkYXRhLmFjcmVzIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFyR2FyYWdlJykudGV4dENvbnRlbnQgPSBkYXRhLmdhcmFnZSB8fCAnLS0nOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhclR5cGUnKS50ZXh0Q29udGVudCA9IGRhdGEucHJvcGVydHlUeXBlIHx8ICctLSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFyWWVhcicpLnRleHRDb250ZW50ID0gZGF0YS55ZWFyQnVpbHQgfHwgJy0tJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXJDb25kaXRpb24nKS50ZXh0Q29udGVudCA9IGRhdGEuY29uZGl0aW9uIHx8ICctLSc7CgogICAgICAgICAgICAvLyBFcXVpdHkKICAgICAgICAgICAgaWYgKGRhdGEuZXF1aXR5KSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXF1aXR5RG9sbGFycycpLnRleHRDb250ZW50ID0gZm9ybWF0Q3VycmVuY3koZGF0YS5lcXVpdHkuZXF1aXR5RG9sbGFycyk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXF1aXR5UGVyY2VudCcpLnRleHRDb250ZW50ID0gCiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcXVpdHkuZXF1aXR5UGVyY2VudGFnZSA/IGRhdGEuZXF1aXR5LmVxdWl0eVBlcmNlbnRhZ2UgKyAnJScgOiAnLS0nOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2x0dlJhdGlvJykudGV4dENvbnRlbnQgPSAKICAgICAgICAgICAgICAgICAgICBkYXRhLmVxdWl0eS5sdHZSYXRpbyA/IGRhdGEuZXF1aXR5Lmx0dlJhdGlvICsgJyUnIDogJy0tJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZGF0YS5lcXVpdHkuaXNVbmRlcndhdGVyID8gJ1VOREVSV0FURVInIDogCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmVxdWl0eS5oYXNFcXVpdHkgPyAnUE9TSVRJVkUgRVFVSVRZJyA6ICdVTktOT1dOJzsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1c0NsYXNzID0gZGF0YS5lcXVpdHkuaXNVbmRlcndhdGVyID8gJ2RhbmdlcicgOiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZXF1aXR5Lmhhc0VxdWl0eSA/ICdzdWNjZXNzJyA6ICcnOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VxdWl0eVN0YXR1cycpLmlubmVySFRNTCA9IAogICAgICAgICAgICAgICAgICAgIGA8c3BhbiBjbGFzcz0iJHtzdGF0dXNDbGFzc30iPiR7c3RhdHVzfTwvc3Bhbj5gOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBPd25lciBJbnRlbGxpZ2VuY2UKICAgICAgICAgICAgaWYgKGRhdGEub3duZXIpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvd25lck5hbWUnKS50ZXh0Q29udGVudCA9IGRhdGEub3duZXIubmFtZSB8fCAnLS0nOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ293bmVyVHlwZScpLnRleHRDb250ZW50ID0gZGF0YS5vd25lci5vd25lcnNoaXBUeXBlIHx8ICctLSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3duZXJzaGlwTGVuZ3RoJykudGV4dENvbnRlbnQgPSAKICAgICAgICAgICAgICAgICAgICBkYXRhLm93bmVyLm93bmVyc2hpcExlbmd0aCA/IGRhdGEub3duZXIub3duZXJzaGlwTGVuZ3RoICsgJyB5ZWFycycgOiAnLS0nOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBvd25lckZsYWdzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3duZXJGbGFncycpOwogICAgICAgICAgICAgICAgb3duZXJGbGFnc0VsLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAgICAgaWYgKGRhdGEub3duZXIuaXNBYnNlbnRlZSkgewogICAgICAgICAgICAgICAgICAgIG93bmVyRmxhZ3NFbC5pbm5lckhUTUwgKz0gJzxzcGFuIGNsYXNzPSJyaXNrLWZsYWcgZmxhZy13YXJuaW5nIj5BQlNFTlRFRTwvc3Bhbj4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRhdGEub3duZXIuaXNDb3Jwb3JhdGVPd25lZCkgewogICAgICAgICAgICAgICAgICAgIG93bmVyRmxhZ3NFbC5pbm5lckhUTUwgKz0gJzxzcGFuIGNsYXNzPSJyaXNrLWZsYWcgZmxhZy1pbmZvIj5DT1JQT1JBVEU8L3NwYW4+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRW52aXJvbm1lbnRhbAogICAgICAgICAgICBpZiAoZGF0YS5lbnZpcm9ubWVudGFsKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvb2Rab25lJykudGV4dENvbnRlbnQgPSBkYXRhLmVudmlyb25tZW50YWwuZmxvb2Rab25lIHx8ICctLSc7CiAgICAgICAgICAgICAgICBjb25zdCBmbG9vZFJpc2sgPSBkYXRhLmVudmlyb25tZW50YWwuZmxvb2RSaXNrIHx8ICdVTktOT1dOJzsKICAgICAgICAgICAgICAgIGNvbnN0IHJpc2tDbGFzcyA9IGZsb29kUmlzayA9PT0gJ0hJR0gnID8gJ2RhbmdlcicgOiBmbG9vZFJpc2sgPT09ICdNT0RFUkFURScgPyAnd2FybmluZycgOiAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmxvb2RSaXNrJykuaW5uZXJIVE1MID0gCiAgICAgICAgICAgICAgICAgICAgYDxzcGFuIGNsYXNzPSIke3Jpc2tDbGFzc30iPiR7Zmxvb2RSaXNrfTwvc3Bhbj5gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBlbnZGbGFnc0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vudmlyb25tZW50YWxGbGFncycpOwogICAgICAgICAgICAgICAgZW52RmxhZ3NFbC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgIGlmIChmbG9vZFJpc2sgPT09ICdISUdIJykgewogICAgICAgICAgICAgICAgICAgIGVudkZsYWdzRWwuaW5uZXJIVE1MICs9ICc8c3BhbiBjbGFzcz0icmlzay1mbGFnIGZsYWctZGFuZ2VyIj5ISUdIIEZMT09EIFJJU0s8L3NwYW4+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2Nob29scwogICAgICAgICAgICBpZiAoZGF0YS5zY2hvb2xzKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2Nob29sRGlzdHJpY3QnKS50ZXh0Q29udGVudCA9IGRhdGEuc2Nob29scy5kaXN0cmljdCB8fCAnLS0nOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjaG9vbEVsZW1lbnRhcnknKS50ZXh0Q29udGVudCA9IGRhdGEuc2Nob29scy5lbGVtZW50YXJ5U2Nob29sIHx8ICctLSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2Nob29sSGlnaCcpLnRleHRDb250ZW50ID0gZGF0YS5zY2hvb2xzLmhpZ2hTY2hvb2wgfHwgJy0tJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRGlzdHJlc3MgSW5kaWNhdG9ycwogICAgICAgICAgICBpZiAoZGF0YS5kaXN0cmVzcyAmJiAoZGF0YS5kaXN0cmVzcy5pc0luRm9yZWNsb3N1cmUgfHwgZGF0YS5kaXN0cmVzcy5pc1JFTykpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXN0cmVzc1NlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RyZXNzRmxhZ3NFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXN0cmVzc0ZsYWdzJyk7CiAgICAgICAgICAgICAgICBkaXN0cmVzc0ZsYWdzRWwuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkYXRhLmRpc3RyZXNzLmlzSW5Gb3JlY2xvc3VyZSkgewogICAgICAgICAgICAgICAgICAgIGRpc3RyZXNzRmxhZ3NFbC5pbm5lckhUTUwgKz0gJzxzcGFuIGNsYXNzPSJyaXNrLWZsYWcgZmxhZy1kYW5nZXIiPkZPUkVDTE9TVVJFPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5kaXN0cmVzcy5pc1JFTykgewogICAgICAgICAgICAgICAgICAgIGRpc3RyZXNzRmxhZ3NFbC5pbm5lckhUTUwgKz0gJzxzcGFuIGNsYXNzPSJyaXNrLWZsYWcgZmxhZy1kYW5nZXIiPlJFTzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgZGV0YWlscyA9ICcnOwogICAgICAgICAgICAgICAgaWYgKGRhdGEuZGlzdHJlc3MuZm9yZWNsb3N1cmVEYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgZGV0YWlscyArPSBgRm9yZWNsb3N1cmU6ICR7bmV3IERhdGUoZGF0YS5kaXN0cmVzcy5mb3JlY2xvc3VyZURhdGUpLnRvTG9jYWxlRGF0ZVN0cmluZygpfTxicj5gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRhdGEuZGlzdHJlc3MuYXVjdGlvbkRhdGUpIHsKICAgICAgICAgICAgICAgICAgICBkZXRhaWxzICs9IGBBdWN0aW9uOiAke25ldyBEYXRlKGRhdGEuZGlzdHJlc3MuYXVjdGlvbkRhdGUpLnRvTG9jYWxlRGF0ZVN0cmluZygpfWA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzdHJlc3NEZXRhaWxzJykuaW5uZXJIVE1MID0gZGV0YWlsczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQWRkaXRpb25hbCBEZXRhaWxzCiAgICAgICAgICAgIGlmIChkYXRhLmJ1aWxkaW5nKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsU3RvcmllcycpLnRleHRDb250ZW50ID0gZGF0YS5idWlsZGluZy5zdG9yaWVzIHx8ICctLSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsUXVhbGl0eScpLnRleHRDb250ZW50ID0gZGF0YS5idWlsZGluZy5xdWFsaXR5IHx8ICctLSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsUG9vbCcpLnRleHRDb250ZW50ID0gZGF0YS5idWlsZGluZy5wb29sID8gJ1llcycgOiAnTm8nOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbEZpcmVwbGFjZScpLnRleHRDb250ZW50ID0gZGF0YS5idWlsZGluZy5maXJlcGxhY2UgPyAnWWVzJyA6ICdObyc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsSGVhdGluZycpLnRleHRDb250ZW50ID0gZGF0YS5idWlsZGluZy5oZWF0aW5nIHx8ICctLSc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsQ29vbGluZycpLnRleHRDb250ZW50ID0gZGF0YS5idWlsZGluZy5jb29saW5nIHx8ICctLSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChkYXRhLmFzc2Vzc21lbnQpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxUYXhBbW91bnQnKS50ZXh0Q29udGVudCA9IGZvcm1hdEN1cnJlbmN5KGRhdGEuYXNzZXNzbWVudC50YXhBbW91bnQpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbFRheFBlclNxZnQnKS50ZXh0Q29udGVudCA9IAogICAgICAgICAgICAgICAgICAgIGRhdGEuYXNzZXNzbWVudC50YXhQZXJTcWZ0ID8gJyQnICsgZGF0YS5hc3Nlc3NtZW50LnRheFBlclNxZnQgOiAnLS0nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoZGF0YS5tZXRhZGF0YSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbEF0dG9tSWQnKS50ZXh0Q29udGVudCA9IGRhdGEubWV0YWRhdGEuYXR0b21JZCB8fCAnLS0nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBGb3JtYXQgY3VycmVuY3kKICAgICAgICBmdW5jdGlvbiBmb3JtYXRDdXJyZW5jeSh2YWx1ZSkgewogICAgICAgICAgICBpZiAoIXZhbHVlICYmIHZhbHVlICE9PSAwKSByZXR1cm4gJy0tJzsKICAgICAgICAgICAgcmV0dXJuICckJyArIE1hdGgucm91bmQodmFsdWUpLnRvTG9jYWxlU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgY2VudGVyIHZhbHVlIHdoZW4gdXNlciBlZGl0cwogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNlbnRlclZhbHVlKCkgewogICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZW50ZXJWYWx1ZScpOwogICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCd1c2VyLW92ZXJyaWRlJyk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDZW50ZXIgdmFsdWUgdXBkYXRlZDonLCBpbnB1dC52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBUb2dnbGUgY29sbGFwc2libGUgc2VjdGlvbnMKICAgICAgICBmdW5jdGlvbiB0b2dnbGVDb2xsYXBzaWJsZShpZCkgewogICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgICAgICBjb25zdCB0cmlnZ2VyID0gY29udGVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwogICAgICAgICAgICAKICAgICAgICAgICAgY29udGVudC5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTsKICAgICAgICAgICAgdHJpZ2dlci5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKTsKICAgICAgICB9CgogICAgICAgIC8vIEdlbmVyYXRlIENNQSAoZW5oYW5jZWQgd2l0aCBtdWx0aS1wcm9wZXJ0eSBzdXBwb3J0KQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQ01BKCkgewogICAgICAgICAgICBpZiAoIWN1cnJlbnRQcm9wZXJ0eURhdGEpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCdQbGVhc2UgbG9hZCBwcm9wZXJ0eSBkYXRhIGZpcnN0Jyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNlbnRlclZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NlbnRlclZhbHVlJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbWFSYWRpdXMnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgZGF5c0JhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21hRGF5c0JhY2snKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgYWRkcmVzcyA9IGN1cnJlbnRQcm9wZXJ0eURhdGEuYWRkcmVzc19xdWVyaWVkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJqZWN0QWRkcmVzcycpLnZhbHVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXJjaGl2ZSBwcmV2aW91cyBDTUEgdG8gbm90ZXMgaWYgdGhpcyBpcyAybmQrIENNQQogICAgICAgICAgICBpZiAoZnViQ29udGV4dD8ucGVyc29uPy5jdXN0b21XSUxMT1dDTUFMaW5rKSB7CiAgICAgICAgICAgICAgICBhd2FpdCBhcmNoaXZlQ01BVG9Ob3RlcygKICAgICAgICAgICAgICAgICAgICBmdWJDb250ZXh0LnBlcnNvbi5jdXN0b21XSUxMT1dDTUFBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgIGZ1YkNvbnRleHQucGVyc29uLmN1c3RvbVdJTExPV0NNQUxpbmssCiAgICAgICAgICAgICAgICAgICAgZnViQ29udGV4dC5wZXJzb24uY3VzdG9tV0lMTE9XQ01BRGF0ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYWxlcnQoYENNQSBHZW5lcmF0aW9uXG5cblByb3BlcnR5OiAke2FkZHJlc3N9XG5DZW50ZXIgVmFsdWU6ICR7Y2VudGVyVmFsdWV9XG5SYWRpdXM6ICR7cmFkaXVzfSBtaWxlc1xuRGF5cyBCYWNrOiAke2RheXNCYWNrfVxuXG5JbnRlZ3JhdGluZyB3aXRoIENsb3VkQ01BLi4uYCk7CiAgICAgICAgfQoKICAgICAgICAvLyBBcmNoaXZlIENNQSB0byBGVUIgbm90ZXMKICAgICAgICBhc3luYyBmdW5jdGlvbiBhcmNoaXZlQ01BVG9Ob3RlcyhhZGRyZXNzLCBsaW5rLCBkYXRlKSB7CiAgICAgICAgICAgIGlmICghZnViQ29udGV4dCB8fCAhZnViQ29udGV4dC5wZXJzb24pIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IG5vdGVDb250ZW50ID0gYENNQSBIaXN0b3J5IEVudHJ5Ci0tLQpEYXRlOiAke2RhdGV9ClByb3BlcnR5OiAke2FkZHJlc3N9CkNNQSBMaW5rOiAke2xpbmt9ClN0YXR1czogQXJjaGl2ZWQKYDsKCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBcmNoaXZpbmcgQ01BIHRvIG5vdGVzOicsIG5vdGVDb250ZW50KTsKICAgICAgICAgICAgLy8gVE9ETzogSW1wbGVtZW50IEZVQiBub3RlcyBBUEkgY2FsbCB3aGVuIHJlYWR5CiAgICAgICAgfQoKICAgICAgICAvLyBFeHBvcnQgdG8gRlVCCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0RGF0YSgpIHsKICAgICAgICAgICAgaWYgKCFjdXJyZW50UHJvcGVydHlEYXRhKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnUGxlYXNlIGxvYWQgcHJvcGVydHkgZGF0YSBmaXJzdCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhbGVydCgnRXhwb3J0aW5nIHByb3BlcnR5IGludGVsbGlnZW5jZSB0byBGVUIgY3VzdG9tIGZpZWxkcy4uLicpOwogICAgICAgIH0KICAgIDwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K';
            const html = Buffer.from(htmlBase64, 'base64').toString('utf8');
            
            return {
                statusCode: 200,
                headers: {
                    'Content-Type': 'text/html',
                    'Access-Control-Allow-Origin': '*'
                },
                body: html
            };
        }

        // Route to appropriate API handler
        switch (action) {
            case 'getPersonData':
                return await getPersonData(params.personId, headers);
            
            case 'generateCMA':
                return await generateCMA(params, headers);
            
            case 'getHomebeatData':
                return await getHomebeatData(params.personId, headers);
            
            case 'resendHomebeat':
                return await resendHomebeat(params, headers);
            
            case 'createTask':
                return await createTask(params, headers);
            
            case 'createManualAction':
                return await createManualAction(params, headers);
            
            default:
                return {
                    statusCode: 400,
                    headers,
                    body: JSON.stringify({ error: 'Invalid action' })
                };
        }

    } catch (error) {
        console.error('Function error:', error);
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: error.message })
        };
    }
};

// Get person data from FUB
async function getPersonData(personId, headers) {
    try {
        const personData = await fubAPIRequest('GET', `/v1/people/${personId}`);
        
        return {
            statusCode: 200,
            headers,
            body: JSON.stringify(personData)
        };
    } catch (error) {
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: 'Failed to fetch person data: ' + error.message })
        };
    }
}

// Generate CMA with CloudCMA API
async function generateCMA(params, headers) {
    try {
        const {
            personId,
            address,
            beds,
            baths,
            sqft,
            radius,
            monthsBack,
            minListings,
            propType,
            title,
            createHomebeat,
            homebeatFrequency
        } = params;

        // Get person data for lead info
        const personData = await fubAPIRequest('GET', `/v1/people/${personId}`);

        // Build CMA URL
        const cmaParams = new URLSearchParams({
            api_key: CLOUDCMA_API_KEY,
            address: address,
            beds: beds || '',
            baths: baths || '',
            sqft: sqft || '',
            radius: radius || '0.75',
            months_back: monthsBack || '9',
            min_listings: minListings || '10',
            prop_type: propType || '',
            title: title || `${personData.name || 'Client'} - ${address}`,
            callback_url: WEBHOOK_URL
        });

        const cmaUrl = `https://cloudcma.com/cmas/new?${cmaParams.toString()}`;

        // Update FUB custom fields
        const updatePayload = {
            customWILLOWCMADate: new Date().toISOString(),
            customWILLOWCMAAddress: address,
            customWILLOWCMALink: cmaUrl
        };

        await fubAPIRequest('PUT', `/v1/people/${personId}`, updatePayload);

        // Create FUB activity
        await fubAPIRequest('POST', '/v1/events', {
            person_id: parseInt(personId),
            type: 'Note',
            body: `CMA generated for ${address}. Parameters: ${beds}bd/${baths}ba, ${sqft}sqft, ${radius}mi radius, ${monthsBack}mo back.`
        });

        let homebeatUrl = null;
        let homebeatCreated = false;

        // Create Homebeat if requested
        if (createHomebeat === true || createHomebeat === 'true') {
            try {
                const homebeatPayload = {
                    automation: {
                        api_key: CLOUDCMA_API_KEY,
                        frequency: homebeatFrequency || 'quarterly',
                        welcome_email: 'true',
                        report: {
                            prop_type: propType || null,
                            callback_url: null
                        },
                        subject_property: {
                            address: address,
                            sqft: sqft || null,
                            beds: beds || null,
                            baths: baths || null
                        },
                        lead: {
                            name: personData.name || '',
                            email_address: personData.emails?.[0]?.value || '',
                            phone: personData.phones?.[0]?.value || ''
                        }
                    }
                };

                const homebeatResponse = await cloudCMAAPIRequest('POST', '/homebeats/widget', homebeatPayload);
                homebeatCreated = true;
                homebeatUrl = homebeatResponse.homebeat_url || null;

                // Update FUB with Homebeat info
                await fubAPIRequest('PUT', `/v1/people/${personId}`, {
                    customWILLOWCloudCMAHomeBeatURL: homebeatUrl,
                    customWILLOWHomebeatFirstSendDate: new Date().toISOString()
                });

                // Create FUB activity for Homebeat
                await fubAPIRequest('POST', '/v1/events', {
                    person_id: parseInt(personId),
                    type: 'Note',
                    body: `Homebeat subscription created for ${address}. Frequency: ${homebeatFrequency}. Lead will receive automated market updates.`
                });

            } catch (homebeatError) {
                console.error('Homebeat creation failed:', homebeatError);
            }
        }

        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({
                success: true,
                cmaUrl: cmaUrl,
                homebeatCreated: homebeatCreated,
                homebeatUrl: homebeatUrl
            })
        };

    } catch (error) {
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: 'Failed to generate CMA: ' + error.message })
        };
    }
}

// Get Homebeat data from CloudCMA
async function getHomebeatData(personId, headers) {
    try {
        // Try to fetch homebeat data, but gracefully handle CloudCMA auth failures
        let homebeatReport = [];
        try {
            homebeatReport = await cloudCMAAPIRequest('GET', `/homebeats/report?api_key=${CLOUDCMA_API_KEY}&format=json`);
        } catch (cloudCMAError) {
            console.warn('CloudCMA API unavailable:', cloudCMAError.message);
            // Return empty homebeats array instead of failing
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify({ 
                    homebeats: [],
                    warning: 'CloudCMA API unavailable. Check API key configuration.'
                })
            };
        }

        const personData = await fubAPIRequest('GET', `/v1/people/${personId}`);
        const personEmail = personData.emails?.[0]?.value?.toLowerCase();

        if (!personEmail) {
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify({ homebeats: [] })
            };
        }

        const leadHomebeats = (homebeatReport || []).filter(hb => 
            hb.lead_email?.toLowerCase() === personEmail
        );

        const enrichedHomebeats = leadHomebeats.map(hb => ({
            ...hb,
            first_send_date: personData.customWILLOWHomebeatFirstSendDate || hb.created_at,
            status: (hb.total_views || 0) === 0 ? 'pending' : 'active'
        }));

        if (enrichedHomebeats.length > 0) {
            const totalViews = enrichedHomebeats.reduce((sum, hb) => sum + (hb.total_views || 0), 0);
            const latestView = enrichedHomebeats
                .map(hb => hb.last_view)
                .filter(v => v)
                .sort()
                .reverse()[0];

            await fubAPIRequest('PUT', `/v1/people/${personId}`, {
                customWILLOWHomebeatViews: totalViews,
                customWILLOWHomebeatLastView: latestView || null
            });
        }

        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({ homebeats: enrichedHomebeats })
        };

    } catch (error) {
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: 'Failed to fetch Homebeat data: ' + error.message })
        };
    }
}

// Resend Homebeat
async function resendHomebeat(params, headers) {
    try {
        const { homebeatId, personId } = params;

        const personData = await fubAPIRequest('GET', `/v1/people/${personId}`);
        
        const homebeatReport = await cloudCMAAPIRequest('GET', `/homebeats/report?api_key=${CLOUDCMA_API_KEY}&format=json`);
        const homebeat = (homebeatReport || []).find(hb => hb.id === homebeatId);

        if (!homebeat) {
            throw new Error('Homebeat not found');
        }

        const homebeatPayload = {
            automation: {
                api_key: CLOUDCMA_API_KEY,
                frequency: homebeat.frequency || 'quarterly',
                welcome_email: 'true',
                subject_property: {
                    address: homebeat.property_address,
                    sqft: homebeat.sqft || null,
                    beds: homebeat.beds || null,
                    baths: homebeat.baths || null
                },
                lead: {
                    name: personData.name || '',
                    email_address: personData.emails?.[0]?.value || '',
                    phone: personData.phones?.[0]?.value || ''
                }
            }
        };

        await cloudCMAAPIRequest('POST', '/homebeats/widget', homebeatPayload);

        await fubAPIRequest('PUT', `/v1/people/${personId}`, {
            customWILLOWHomebeatLastResend: new Date().toISOString()
        });

        await fubAPIRequest('POST', '/v1/events', {
            person_id: parseInt(personId),
            type: 'Note',
            body: `Homebeat resent for ${homebeat.property_address}. Status was pending (0 views). Manual resend triggered.`
        });

        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({ success: true })
        };

    } catch (error) {
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: 'Failed to resend Homebeat: ' + error.message })
        };
    }
}

// Create task in FUB
async function createTask(params, headers) {
    try {
        const { personId, taskDescription, urgency, assignedTo } = params;

        const now = new Date();
        let dueDate = new Date(now);
        
        switch (urgency) {
            case 'IMMEDIATE':
                dueDate.setHours(now.getHours() + 24);
                break;
            case 'SAME_DAY':
                dueDate.setHours(23, 59, 59);
                break;
            case 'NEXT_DAY':
                dueDate.setDate(now.getDate() + 1);
                break;
            case 'WEEKLY':
                dueDate.setDate(now.getDate() + 7);
                break;
            default:
                dueDate.setDate(now.getDate() + 1);
        }

        // FUB tasks API doesn't accept description/body field
        // Task details should be added as a note after task creation
        const taskPayload = {
            personId: parseInt(personId),
            type: 'Follow Up',
            dueDate: dueDate.toISOString()
        };

        const taskResult = await fubAPIRequest('POST', '/v1/tasks', taskPayload);
        
        // Add task details as a note
        const notePayload = {
            personId: parseInt(personId),
            subject: `Task: ${taskDescription}`,
            body: `${taskDescription}\n\nAssigned to: ${assignedTo}\nUrgency: ${urgency}\nDue: ${dueDate.toLocaleDateString()}`,
            isHtml: false
        };
        await fubAPIRequest('POST', '/v1/notes', notePayload);

        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({ success: true })
        };

    } catch (error) {
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: 'Failed to create task: ' + error.message })
        };
    }
}

// Create manual action in FUB
async function createManualAction(params, headers) {
    try {
        const { personId, actionType, assignedTo, urgency, notes } = params;

        const now = new Date();
        let dueDate = new Date(now);
        
        switch (urgency) {
            case 'IMMEDIATE':
                dueDate.setHours(now.getHours() + 24);
                break;
            case 'SAME_DAY':
                dueDate.setHours(23, 59, 59);
                break;
            case 'NEXT_DAY':
                dueDate.setDate(now.getDate() + 1);
                break;
            case 'WEEKLY':
                dueDate.setDate(now.getDate() + 7);
                break;
            default:
                dueDate.setDate(now.getDate() + 1);
        }

        // Map action types to FUB task types
        const taskTypeMap = {
            'Task': 'Follow Up',
            'Call': 'Call',
            'Email': 'Email',
            'Text': 'Text',
            'Note': 'Note'
        };
        
        const fubType = taskTypeMap[actionType] || 'Follow Up';
        
        // If it's a Note, use /v1/notes endpoint, otherwise use /v1/tasks
        if (actionType === 'Note') {
            const notePayload = {
                personId: parseInt(personId),
                subject: `${urgency} Action`,
                body: `${notes}\n\nAssigned to: ${assignedTo}`,
                isHtml: false
            };
            await fubAPIRequest('POST', '/v1/notes', notePayload);
        } else {
            // FUB tasks API doesn't accept description field
            const taskPayload = {
                personId: parseInt(personId),
                type: fubType,
                dueDate: dueDate.toISOString()
            };
            await fubAPIRequest('POST', '/v1/tasks', taskPayload);
            
            // Add action details as a note
            const notePayload = {
                personId: parseInt(personId),
                subject: `${fubType} Action`,
                body: `${notes}\n\nAssigned to: ${assignedTo}\nUrgency: ${urgency}`,
                isHtml: false
            };
            await fubAPIRequest('POST', '/v1/notes', notePayload);
        }

        return {
            statusCode: 200,
            headers,
            body: JSON.stringify({ success: true })
        };

    } catch (error) {
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: 'Failed to create action: ' + error.message })
        };
    }
}

// FUB API Request Helper
function fubAPIRequest(method, path, data = null) {
    return new Promise((resolve, reject) => {
        const options = {
            hostname: 'api.followupboss.com',
            port: 443,
            path: path,
            method: method,
            headers: {
                'Authorization': `Basic ${Buffer.from(FUB_API_KEY + ':').toString('base64')}`,
                'Content-Type': 'application/json'
            }
        };

        const req = https.request(options, (res) => {
            let body = '';
            res.on('data', (chunk) => body += chunk);
            res.on('end', () => {
                try {
                    const parsed = JSON.parse(body);
                    if (res.statusCode >= 200 && res.statusCode < 300) {
                        resolve(parsed);
                    } else {
                        reject(new Error(`FUB API error: ${res.statusCode} - ${body}`));
                    }
                } catch (e) {
                    reject(new Error(`Failed to parse FUB response: ${body}`));
                }
            });
        });

        req.on('error', reject);
        
        if (data) {
            req.write(JSON.stringify(data));
        }
        
        req.end();
    });
}

// CloudCMA API Request Helper
function cloudCMAAPIRequest(method, path, data = null) {
    return new Promise((resolve, reject) => {
        const options = {
            hostname: 'cloudcma.com',
            port: 443,
            path: path,
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        };

        const req = https.request(options, (res) => {
            let body = '';
            res.on('data', (chunk) => body += chunk);
            res.on('end', () => {
                try {
                    const parsed = body ? JSON.parse(body) : {};
                    if (res.statusCode >= 200 && res.statusCode < 300) {
                        resolve(parsed);
                    } else {
                        reject(new Error(`CloudCMA API error: ${res.statusCode} - ${body}`));
                    }
                } catch (e) {
                    if (res.statusCode >= 200 && res.statusCode < 300) {
                        resolve({});
                    } else {
                        reject(new Error(`Failed to parse CloudCMA response: ${body}`));
                    }
                }
            });
        });

        req.on('error', reject);
        
        if (data) {
            req.write(JSON.stringify(data));
        }
        
        req.end();
    });
}
